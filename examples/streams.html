<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Streaming Axis and Button Hold values &mdash; Approximate Engineering - Input 2.6.4 documentation</title>
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/documentation_options.js?v=5248d183"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Approximate Engineering - Input 2.6.4 documentation"
          href="../_static/opensearch.xml"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tiny4WD Robot Drive" href="tiny4wd.html" />
    <link rel="prev" title="Controller Failover" href="failover.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Approximate Engineering - Input
          </a>
              <div class="version">
                2.6.4
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../simpleusage.html">Simple Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../simpleusage.html#standard-names">Standard Names</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commandline.html">Command-line tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bluetooth.html">Pairing Controllers over Bluetooth</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profiling.html">Profiling and Testing Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../addingcontrollers.html">Adding support for a new controller type</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="camjam.html">CamJam Edukit 3 Robot</a></li>
<li class="toctree-l2"><a class="reference internal" href="failover.html">Controller Failover</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Streaming Axis and Button Hold values</a></li>
<li class="toctree-l2"><a class="reference internal" href="tiny4wd.html">Tiny4WD Robot Drive</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../howtouse.html">Advanced Usage Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sys.html">LEDs and Battery Monitoring</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Approximate Engineering - Input</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../examples.html">Examples</a></li>
      <li class="breadcrumb-item active">Streaming Axis and Button Hold values</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="streaming-axis-and-button-hold-values">
<span id="example-stream"></span><h1>Streaming Axis and Button Hold values<a class="headerlink" href="#streaming-axis-and-button-hold-values" title="Link to this heading">¶</a></h1>
<p>Some other APIs, most notably <a class="reference external" href="http://gpiozero.readthedocs.io/en/stable/index.html">Gpiozero</a>, can configure devices to read from iterators over data such as axis values. To
use this facility we need to be able to produce generators (iterators which work over lazily evaluated, potentially
infinite, sets of data) containing streams of axis and button hold values. These generators can then be set as the
source for anything in e.g. Gpiozero which has a <a class="reference external" href="http://gpiozero.readthedocs.io/en/stable/api_generic.html#sourcemixin">SourceMixin</a> defined, including motors and similar.</p>
<p>The example below doesn’t use Gpiozero, but instead shows how a stream of x,y values from the left analogue stick is
created, then used by an infinite loop to print those values. The loop only exits with a StopIteration exception when
the controller disconnects. This is also an example of explicitly creating and binding a controller, rather than using
the resource abstraction shown in the other examples.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="kn">from</span> <span class="nn">approxeng.input.controllers</span> <span class="kn">import</span> <span class="n">find_matching_controllers</span><span class="p">,</span> <span class="n">ControllerRequirement</span>
<span class="linenos"> 4</span><span class="kn">from</span> <span class="nn">approxeng.input.selectbinder</span> <span class="kn">import</span> <span class="n">bind_controllers</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="n">discovery</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="c1"># Look for an attached controller, requiring that it has &#39;lx&#39; and &#39;ly&#39; controls, looping until we find one.</span>
<span class="linenos"> 9</span><span class="k">while</span> <span class="n">discovery</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">10</span>    <span class="k">try</span><span class="p">:</span>
<span class="linenos">11</span>        <span class="n">discovery</span> <span class="o">=</span> <span class="n">find_matching_controllers</span><span class="p">(</span><span class="n">ControllerRequirement</span><span class="p">(</span><span class="n">require_snames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lx&#39;</span><span class="p">,</span> <span class="s1">&#39;ly&#39;</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">12</span>    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
<span class="linenos">13</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No suitable controller found yet&#39;</span><span class="p">)</span>
<span class="linenos">14</span>        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="c1"># Bind the controller to the underlying event stream, returning a function used to tidy up</span>
<span class="linenos">17</span><span class="n">unbind_function</span> <span class="o">=</span> <span class="n">bind_controllers</span><span class="p">(</span><span class="n">discovery</span><span class="p">,</span> <span class="n">print_events</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="k">try</span><span class="p">:</span>
<span class="linenos">20</span>    <span class="c1"># Get a stream of values for the left stick x and y axes. If we were using robot code from gpio.zero we could</span>
<span class="linenos">21</span>    <span class="c1"># set the controller.stream[...] as a source, as sources are just iterators which produce sequences of values</span>
<span class="linenos">22</span>    <span class="k">for</span> <span class="n">lx</span><span class="p">,</span> <span class="n">ly</span> <span class="ow">in</span> <span class="n">discovery</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">stream</span><span class="p">[</span><span class="s1">&#39;lx&#39;</span><span class="p">,</span> <span class="s1">&#39;ly&#39;</span><span class="p">]:</span>
<span class="linenos">23</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Left stick: x=</span><span class="si">{}</span><span class="s1">, y=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lx</span><span class="p">,</span> <span class="n">ly</span><span class="p">))</span>
<span class="linenos">24</span>        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
<span class="linenos">25</span><span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
<span class="linenos">26</span>    <span class="c1"># Raised when the stream ends</span>
<span class="linenos">27</span>    <span class="k">pass</span>
<span class="linenos">28</span>
<span class="linenos">29</span><span class="c1"># Tidy up any resources (threads, file handles) used by the binder</span>
<span class="linenos">30</span><span class="n">unbind_function</span><span class="p">()</span>
</pre></div>
</div>
<p>Note particularly that there’s only one call to create the stream, on line 21, and that afterwards this is just like any
other iterable thing in Python, each time around the loop the next value (in this case a tuple of lx and ly axis values)
is taken off the stream.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="failover.html" class="btn btn-neutral float-left" title="Controller Failover" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tiny4wd.html" class="btn btn-neutral float-right" title="Tiny4WD Robot Drive" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017 to 2024 Tom Oinn.
      <span class="lastupdated">Last updated on Feb 15, 2024.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>