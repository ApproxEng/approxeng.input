<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pairing Controllers over Bluetooth &mdash; Approximate Engineering - Input 2.6.4 documentation</title>
      <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/documentation_options.js?v=5248d183"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Approximate Engineering - Input 2.6.4 documentation"
          href="_static/opensearch.xml"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Profiling and Testing Controllers" href="profiling.html" />
    <link rel="prev" title="Command-line tools" href="commandline.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Approximate Engineering - Input
          </a>
              <div class="version">
                2.6.4
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="simpleusage.html">Simple Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="simpleusage.html#standard-names">Standard Names</a></li>
<li class="toctree-l1"><a class="reference internal" href="commandline.html">Command-line tools</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Pairing Controllers over Bluetooth</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pairing-with-bluetoothctl">Pairing with Bluetoothctl</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="profiling.html">Profiling and Testing Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="addingcontrollers.html">Adding support for a new controller type</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="howtouse.html">Advanced Usage Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="sys.html">LEDs and Battery Monitoring</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Approximate Engineering - Input</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Pairing Controllers over Bluetooth</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pairing-controllers-over-bluetooth">
<span id="bluetooth"></span><h1>Pairing Controllers over Bluetooth<a class="headerlink" href="#pairing-controllers-over-bluetooth" title="Link to this heading">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The XBox One S controller is the only XBox controller with bluetooth support. This won’t work for regular (older)
XBox wireless controllers. In addition, there’s a bit of setup required before the bluetooth stack will stay
connected to the controller, see <a class="reference internal" href="api/xboxone.html#api-xboxone"><span class="std std-ref">XBox-One S Controller Support</span></a> for instructions.</p>
</div>
<p>This guide will show you how to discover and pair with a bluetooth device entirely using the command line. Because this
is a one-time process (controllers will, once paired, connect automatically) you could use the graphical tools to pair
the controller in the first place, but I prefer to run everything on my robots without a display so this is how I do it.</p>
<section id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Link to this heading">¶</a></h2>
<p>A standard Raspberry Pi will now come with the necessary bluetooth services installed and running, largely because both
the Pi3 and Pi Zero W have built-in bluetooth and wifi chips. This guide assumes you’re using one of these newer
versions, if you aren’t you may need to explicitly install the bluetooth stack:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pi@raspberrypi<span class="w"> </span>~<span class="w"> </span>$<span class="w"> </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>bluetooth<span class="w"> </span>libbluetooth3<span class="w"> </span>libusb-dev
pi@raspberrypi<span class="w"> </span>~<span class="w"> </span>$<span class="w"> </span>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>bluetooth.service
pi@raspberrypi<span class="w"> </span>~<span class="w"> </span>$<span class="w"> </span>sudo<span class="w"> </span>usermod<span class="w"> </span>-G<span class="w"> </span>bluetooth<span class="w"> </span>-a<span class="w"> </span>pi
</pre></div>
</div>
<p>If you have to do the above, you should power cycle your pi, don’t just restart it. It might be okay, but you’ll make
life more predictable by actually pulling the plug and waiting a few seconds.</p>
</section>
<section id="pairing-with-bluetoothctl">
<h2>Pairing with Bluetoothctl<a class="headerlink" href="#pairing-with-bluetoothctl" title="Link to this heading">¶</a></h2>
<p>Once you have a working bluetooth stack, you can use the bluetoothctl command to configure it. You don’t need to run
this as root, just use your regular user account.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pi@raspberrypi<span class="w"> </span>~<span class="w"> </span>$<span class="w"> </span>bluetoothctl
</pre></div>
</div>
<p>This will put you into a shell-like mode where you can type commands to manipulate the bluetooth stack. It will also
show messages related to connections, controllers (in this context a controller is a bluetooth master, you’ll normally
only have one of these), pairing, scans etc.</p>
<p>The first thing you should do is enable the default agent. The agent is the code which handles pairing requests, and is
necessary to successfully pair with devices which don’t have displays or pairing codes. Once you have the bluetoothctl
shell open, type the following (expected responses from bluetoothctl are shown):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>bluetooth<span class="o">]</span><span class="c1"># agent on</span>
Agent<span class="w"> </span>registered
<span class="o">[</span>bluetooth<span class="o">]</span><span class="c1"># default-agent</span>
Default<span class="w"> </span>agent<span class="w"> </span>request<span class="w"> </span>successful
</pre></div>
</div>
<p>The next step is to start a bluetooth scan. This is used to discover devices which are either connected already or which
are ready to pair. You need to do this in conjunction with putting your device into pairing mode (the exact mechanism
for this varies from device to device, for example on the XBox One controller you hold down the share button while
pressing the home one, but look up the specifics for your particular controller).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>bluetooth<span class="o">]</span><span class="c1"># scan on</span>
Discovery<span class="w"> </span>started
<span class="o">[</span>CHG<span class="o">]</span><span class="w"> </span>Controller<span class="w"> </span>5C:F3:70:66:5C:E2<span class="w"> </span>Discovering:<span class="w"> </span>yes
....<span class="w"> </span>Messages<span class="w"> </span>about<span class="w"> </span>devices<span class="w"> </span>will<span class="w"> </span>follow<span class="w"> </span>here
</pre></div>
</div>
<p>You need to look for messages about your device. Devices are identified by MAC addresses; six part hexadecimal IDs
unique to that particular device. The controller (the bluetooth chipset on your pi) also has a MAC address, in my case
this is the ‘5C:F3:70:66:5C:E2’ part in the above example, yours will be different.</p>
<p>Once you have your device address, you need to issue a ‘pair’, ‘connect’ and ‘trust’ command, to pair with the device,
connect to its services, and to tell the agent that it should trust the device automatically in the future and allow it
to pair with no further checks. You may be asked to confirm these processes (in my example below I’m not because I had
already trusted the device before un-pairing and re-pairing for the example, but if it does just do what it says on the
console).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>....<span class="w"> </span>after<span class="w"> </span>running<span class="w"> </span>the<span class="w"> </span><span class="s1">&#39;scan on&#39;</span><span class="w"> </span>and<span class="w"> </span>telling<span class="w"> </span>my<span class="w"> </span>XBox<span class="w"> </span>controller<span class="w"> </span>to<span class="w"> </span>enter<span class="w"> </span>pairing<span class="w"> </span>mode
<span class="o">[</span>NEW<span class="o">]</span><span class="w"> </span>Device<span class="w"> </span>C8:3F:26:1E:C3:7F<span class="w"> </span>Xbox<span class="w"> </span>Wireless<span class="w"> </span>Controller
<span class="o">[</span>bluetooth<span class="o">]</span><span class="c1"># pair C8:3F:26:1E:C3:7F</span>
Attempting<span class="w"> </span>to<span class="w"> </span>pair<span class="w"> </span>with<span class="w"> </span>C8:3F:26:1E:C3:7F
<span class="o">[</span>CHG<span class="o">]</span><span class="w"> </span>Device<span class="w"> </span>C8:3F:26:1E:C3:7F<span class="w"> </span>Connected:<span class="w"> </span>yes
<span class="o">[</span>CHG<span class="o">]</span><span class="w"> </span>Device<span class="w"> </span>C8:3F:26:1E:C3:7F<span class="w"> </span>Modalias:<span class="w"> </span>usb:v045Ep02E0d0903
<span class="o">[</span>CHG<span class="o">]</span><span class="w"> </span>Device<span class="w"> </span>C8:3F:26:1E:C3:7F<span class="w"> </span>UUIDs:<span class="w"> </span><span class="m">00001124</span>-0000-1000-8000-00805f9b34fb
<span class="o">[</span>CHG<span class="o">]</span><span class="w"> </span>Device<span class="w"> </span>C8:3F:26:1E:C3:7F<span class="w"> </span>UUIDs:<span class="w"> </span><span class="m">00001200</span>-0000-1000-8000-00805f9b34fb
<span class="o">[</span>CHG<span class="o">]</span><span class="w"> </span>Device<span class="w"> </span>C8:3F:26:1E:C3:7F<span class="w"> </span>ServicesResolved:<span class="w"> </span>yes
<span class="o">[</span>CHG<span class="o">]</span><span class="w"> </span>Device<span class="w"> </span>C8:3F:26:1E:C3:7F<span class="w"> </span>Paired:<span class="w"> </span>yes
Pairing<span class="w"> </span>successful
<span class="o">[</span>CHG<span class="o">]</span><span class="w"> </span>Device<span class="w"> </span>C8:3F:26:1E:C3:7F<span class="w"> </span>ServicesResolved:<span class="w"> </span>no
<span class="o">[</span>CHG<span class="o">]</span><span class="w"> </span>Device<span class="w"> </span>C8:3F:26:1E:C3:7F<span class="w"> </span>Connected:<span class="w"> </span>no
<span class="o">[</span>bluetooth<span class="o">]</span><span class="c1"># connect C8:3F:26:1E:C3:7F</span>
Attempting<span class="w"> </span>to<span class="w"> </span>connect<span class="w"> </span>to<span class="w"> </span>C8:3F:26:1E:C3:7F
<span class="o">[</span>CHG<span class="o">]</span><span class="w"> </span>Device<span class="w"> </span>C8:3F:26:1E:C3:7F<span class="w"> </span>Connected:<span class="w"> </span>yes
Connection<span class="w"> </span>successful
<span class="o">[</span>CHG<span class="o">]</span><span class="w"> </span>Device<span class="w"> </span>C8:3F:26:1E:C3:7F<span class="w"> </span>ServicesResolved:<span class="w"> </span>yes
<span class="o">[</span>Xbox<span class="w"> </span>Wireless<span class="w"> </span>Controller<span class="o">]</span><span class="c1"># trust C8:3F:26:1E:C3:7F</span>
<span class="o">[</span>CHG<span class="o">]</span><span class="w"> </span>Device<span class="w"> </span>C8:3F:26:1E:C3:7F<span class="w"> </span>Trusted:<span class="w"> </span>yes
Changing<span class="w"> </span>C8:3F:26:1E:C3:7F<span class="w"> </span>trust<span class="w"> </span>succeeded
<span class="o">[</span>CHG<span class="o">]</span><span class="w"> </span>Device<span class="w"> </span><span class="m">54</span>:60:09:ED:2E:2F<span class="w"> </span>RSSI:<span class="w"> </span>-81
<span class="o">[</span>CHG<span class="o">]</span><span class="w"> </span>Device<span class="w"> </span><span class="m">54</span>:60:09:ED:2E:2F<span class="w"> </span>RSSI:<span class="w"> </span>-89
<span class="o">[</span>Xbox<span class="w"> </span>Wireless<span class="w"> </span>Controller<span class="o">]</span><span class="c1">#</span>
</pre></div>
</div>
<p>You can now exit bluetoothctl by pressing CTRL-D or typing ‘quit’ into the shell.</p>
<p>From now on, your controller (the XBox One S controller in my example) will pair automatically with the bluetooth
adapter on your pi (or other machine if you’ve configured it). Note that if you’re using a bluetooth dongle, the pairing
will have to be re-done if you move the dongle to another computer, so you can’t, say, configure a dongle on a linux
desktop and expect it to just work if you move it to your pi.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="commandline.html" class="btn btn-neutral float-left" title="Command-line tools" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="profiling.html" class="btn btn-neutral float-right" title="Profiling and Testing Controllers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017 to 2024 Tom Oinn.
      <span class="lastupdated">Last updated on Feb 15, 2024.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>