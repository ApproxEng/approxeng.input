

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Streaming Axis and Button Hold values &mdash; Approximate Engineering - Input 2.1.0 documentation</title>
  

  
  
  
  

  

  
  
    
      <link rel="search" type="application/opensearchdescription+xml" title="Search within Approximate Engineering - Input 2.1.0 documentation" href="../_static/opensearch.xml"/>
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Approximate Engineering - Input 2.1.0 documentation" href="../index.html"/>
        <link rel="up" title="Examples" href="../examples.html"/>
        <link rel="next" title="Tiny4WD Robot Drive" href="tiny4wd.html"/>
        <link rel="prev" title="Showing Controller Properties" href="show_controls.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Approximate Engineering - Input
          

          
          </a>

          
            
            
              <div class="version">
                2.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../simpleusage.html">Simple Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../simpleusage.html#standard-names">Standard Names</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bluetooth.html">Pairing Controllers over Bluetooth</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dualshock3.html">Configuring Playstation 3 Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../addingcontrollers.html">Adding support for a new controller type</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="failover.html">Controller Failover</a></li>
<li class="toctree-l2"><a class="reference internal" href="show_controls.html">Showing Controller Properties</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Streaming Axis and Button Hold values</a></li>
<li class="toctree-l2"><a class="reference internal" href="tiny4wd.html">Tiny4WD Robot Drive</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../howtouse.html">Advanced Usage Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Approximate Engineering - Input</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../examples.html">Examples</a> &raquo;</li>
        
      <li>Streaming Axis and Button Hold values</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="streaming-axis-and-button-hold-values">
<span id="example-stream"></span><h1>Streaming Axis and Button Hold values<a class="headerlink" href="#streaming-axis-and-button-hold-values" title="Permalink to this headline">Â¶</a></h1>
<p>Some other APIs, most notably <a class="reference external" href="http://gpiozero.readthedocs.io/en/stable/index.html">Gpiozero</a> can configure devices to read from iterators over data such as axis values. To
use this facility we need to be able to produce generators (iterators which work over lazily evaluated, potentially
infinite, sets of data) containing streams of axis and button hold values. These generators can then be set as the
source for anything in e.g. Gpiozero which has a <a class="reference external" href="http://gpiozero.readthedocs.io/en/stable/api_generic.html#sourcemixin">SourceMixin</a> defined, including motors and similar.</p>
<p>The example below doesn&#8217;t use Gpiozero, but instead shows how a stream of x,y values from the left analogue stick is
created, then used by an infinite loop to print those values. The loop only exits with a StopIteration exception when
the controller disconnects. This is also an example of explicitly creating and binding a controller, rather than using
the resource abstraction shown in the other examples.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">approxeng.input.controllers</span> <span class="kn">import</span> <span class="n">find_any_controller</span>
<span class="kn">from</span> <span class="nn">approxeng.input.selectbinder</span> <span class="kn">import</span> <span class="n">bind_controller</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="n">devices</span><span class="p">,</span> <span class="n">controller</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>

<span class="c1"># Look for an attached controller, looping until we find one.</span>
<span class="k">while</span> <span class="n">controller</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">devices</span><span class="p">,</span> <span class="n">controller</span><span class="p">,</span> <span class="n">physical_address</span> <span class="o">=</span> <span class="n">find_any_controller</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;No controller found yet&#39;</span><span class="p">)</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Bind the controller to the underlying event stream, returning a function used to tidy up</span>
<span class="n">unbind_function</span> <span class="o">=</span> <span class="n">bind_controller</span><span class="p">(</span><span class="n">devices</span><span class="o">=</span><span class="n">devices</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="n">controller</span><span class="p">,</span> <span class="n">print_events</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Get a stream of values for the left stick x and y axes. If we were using robot code from gpio.zero we could</span>
    <span class="c1"># set the controller.stream[...] as a source, as sources are just iterators which produce sequences of values</span>
    <span class="k">for</span> <span class="n">lx</span><span class="p">,</span> <span class="n">ly</span> <span class="ow">in</span> <span class="n">controller</span><span class="o">.</span><span class="n">stream</span><span class="p">[</span><span class="s1">&#39;lx&#39;</span><span class="p">,</span><span class="s1">&#39;ly&#39;</span><span class="p">]:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Left stick: x={}, y={}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lx</span><span class="p">,</span> <span class="n">ly</span><span class="p">))</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
    <span class="c1"># Raised when the stream ends</span>
    <span class="k">pass</span>

<span class="c1"># Tidy up any resources (threads, file handles) used by the binder</span>
<span class="n">unbind_function</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>Note particularly that there&#8217;s only one call to create the stream, on line 21, and that afterwards this is just like any
other iterable thing in Python, each time around the loop the next value (in this case a tuple of lx and ly axis values)
is taken off the stream.</p>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tiny4wd.html" class="btn btn-neutral float-right" title="Tiny4WD Robot Drive" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="show_controls.html" class="btn btn-neutral" title="Showing Controller Properties" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Tom Oinn.
      Last updated on Sep 14, 2017.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>