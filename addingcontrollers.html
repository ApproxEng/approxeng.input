

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Adding support for a new controller type &mdash; Approximate Engineering - Input 1.0.3 documentation</title>
  

  
  
  
  

  

  
  
    
      <link rel="search" type="application/opensearchdescription+xml" title="Search within Approximate Engineering - Input 1.0.3 documentation" href="_static/opensearch.xml"/>
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Approximate Engineering - Input 1.0.3 documentation" href="index.html"/>
        <link rel="prev" title="Rock Candy Controller Support" href="api/rockcandy.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Approximate Engineering - Input
          

          
          </a>

          
            
            
              <div class="version">
                1.0.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="howtouse.html">Usage Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="bluetooth.html">Pairing Controllers over Bluetooth</a></li>
<li class="toctree-l1"><a class="reference internal" href="dualshock3.html">Configuring Playstation 3 Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Documentation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Adding support for a new controller type</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#finding-your-product-and-vendor-id">Finding your product and vendor ID</a></li>
<li class="toctree-l2"><a class="reference internal" href="#clones-of-a-supported-controller">Clones of a supported controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="#writing-a-new-controller-class">Writing a new controller class</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Approximate Engineering - Input</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Adding support for a new controller type</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="adding-support-for-a-new-controller-type">
<h1>Adding support for a new controller type<a class="headerlink" href="#adding-support-for-a-new-controller-type" title="Permalink to this headline">¶</a></h1>
<p>The library supports a number of controllers but it&#8217;s quite possible, given the variety of cheap clones on the market,
that your particular controller isn&#8217;t one of them. You have a few options, depending on the scenario you find yourself
in. Firstly though you&#8217;ll need both product and vendor IDs for your device - these are allocated by the USB consortium
so will definitely not be the same for a clone device as for an original one, for example.</p>
<div class="section" id="finding-your-product-and-vendor-id">
<h2>Finding your product and vendor ID<a class="headerlink" href="#finding-your-product-and-vendor-id" title="Permalink to this headline">¶</a></h2>
<p>Once you have a controller paired over bluetooth, or, in the case of those with specific dongles, otherwise connected,
you can run the <cite>scripts/list_devices.py</cite> to print out a list of all connected devices, including the vendor and product
identifiers. For example, with my XBox One controller paired and connected I see this:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">(</span>viridia-env<span class="o">)</span> tom@Ogre ~/git/approxeng.input/scripts $ python list_devices.py
<span class="o">{</span> <span class="s1">&#39;bus&#39;</span>: <span class="m">5</span>,
  <span class="s1">&#39;fn&#39;</span>: <span class="s1">&#39;/dev/input/event14&#39;</span>,
  <span class="s1">&#39;name&#39;</span>: <span class="s1">&#39;Xbox Wireless Controller&#39;</span>,
  <span class="s1">&#39;phys&#39;</span>: <span class="s1">&#39;5c:f3:70:66:5c:e2&#39;</span>,
  <span class="s1">&#39;product&#39;</span>: <span class="m">736</span>,
  <span class="s1">&#39;vendor&#39;</span>: <span class="m">1118</span>,
  <span class="s1">&#39;version&#39;</span>: <span class="m">2307</span><span class="o">}</span>
</pre></div>
</div>
<p>In general this should show you enough information to identify the controller you&#8217;ve just connected and get the details.</p>
</div>
<div class="section" id="clones-of-a-supported-controller">
<h2>Clones of a supported controller<a class="headerlink" href="#clones-of-a-supported-controller" title="Permalink to this headline">¶</a></h2>
<p>If you have a controller which is an exact copy of one the library supports, but isn&#8217;t autodetected, you can either bind
it yourself, using the class from the library which most closely matches your controller, or you can add autodetect
support to the library, again using the existing class. This might happen if you have, say, a clone PS4 controller which
is identical in every way but which has a different USB vendor and product identifier.</p>
<p>The <code class="xref py py-const docutils literal"><span class="pre">approxeng.input.controllers.CONTROLLERS</span></code> is an array of dicts containing class constructor, vendor ID and
product ID values. This array is searched for matching controllers when a controller class is specified, when no class
is provided this array is used to find any potential matches. If you add an appropriate entry to this array you can
cause the library&#8217;s controller matching to match an existing class with a new pair of vendor and product IDs. So,
supposing you had a new controller which used the <a class="reference internal" href="api/dualshock4.html#approxeng.input.dualshock4.DualShock4" title="approxeng.input.dualshock4.DualShock4"><code class="xref py py-class docutils literal"><span class="pre">approxeng.input.dualshock4.DualShock4</span></code></a> codes for axes and
buttons, but had a different vendor and product ID, you could add it to the match array with:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">approxeng.input.controllers</span>
<span class="kn">from</span> <span class="nn">approxeng.input.dualshock4</span> <span class="kn">import</span> <span class="n">DualShock4</span>

<span class="n">VENDOR_ID</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">PRODUCT_ID</span> <span class="o">=</span> <span class="o">...</span>

<span class="n">approxeng</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">controllers</span><span class="o">.</span><span class="n">CONTROLLERS</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;constructor&#39;</span><span class="p">:</span> <span class="n">DualShock4</span><span class="p">,</span>
                                                <span class="s1">&#39;vendor_id&#39;</span><span class="p">:</span> <span class="n">VENDOR_ID</span><span class="p">,</span>
                                                <span class="s1">&#39;product_id&#39;</span><span class="p">:</span> <span class="n">PRODUCT_ID</span><span class="p">})</span>
</pre></div>
</div>
<p>This will now let you bind using the <cite>controller_class</cite> or no-argument form of the resource and should match your
controller&#8217;s vendor and product IDs to the existing controller class.</p>
</div>
<div class="section" id="writing-a-new-controller-class">
<h2>Writing a new controller class<a class="headerlink" href="#writing-a-new-controller-class" title="Permalink to this headline">¶</a></h2>
<p>It&#8217;s possible you have a controller which is completely different to the ones the library already supports. This might
be because it&#8217;s something we&#8217;ve just never got our hands on, or because the manufacturer has decided to produce a clone
controller with completely different codes for buttons or axes (it happens!). In this case you&#8217;ll need to create a new
subclass of <a class="reference internal" href="api/input.html#approxeng.input.Controller" title="approxeng.input.Controller"><code class="xref py py-class docutils literal"><span class="pre">approxeng.input.Controller</span></code></a> and use the mechanism above to register it. Fortunately this is fairly
simple. First create your class, this won&#8217;t include any button or axis bindings, we&#8217;ll add these later:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">approxeng.input</span> <span class="kn">import</span> <span class="n">Controller</span>

<span class="n">MY_VENDOR_ID</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">MY_PRODUCT_ID</span> <span class="o">=</span> <span class="o">...</span>


<span class="k">class</span> <span class="nc">MyNewController</span><span class="p">(</span><span class="n">Controller</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Driver for my new controller type</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dead_zone</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">hot_zone</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Axis and button definitions for my new controller class</span>

<span class="sd">        :param float dead_zone:</span>
<span class="sd">            Used to set the dead zone for each :class:`approxeng.input.CentredAxis` in the controller.</span>
<span class="sd">        :param float hot_zone:</span>
<span class="sd">            Used to set the hot zone for each :class:`approxeng.input.CentredAxis` in the controller.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyNewController</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">vendor_id</span><span class="o">=</span><span class="n">DS3_VENDOR_ID</span><span class="p">,</span>
                                              <span class="n">product_id</span><span class="o">=</span><span class="n">DS3_PRODUCT_ID</span><span class="p">,</span>
                                              <span class="n">controls</span><span class="o">=</span><span class="p">[],</span>
                                              <span class="n">dead_zone</span><span class="o">=</span><span class="n">dead_zone</span><span class="p">,</span>
                                              <span class="n">hot_zone</span><span class="o">=</span><span class="n">hot_zone</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;My new controller&#39;</span>
</pre></div>
</div>
<p>This is a fairly useless controller, because it doesn&#8217;t have any buttons or axes, but it will get us to the point where
the library tries to send events to it, and that&#8217;s important because when an event is received and not processed by the
controller class we just print it to the console. This means that if you register your new class with its associated
vendor and product IDs (as above) and run the <cite>scripts/select_binder_resource_example.py</cite> script you should start seeing
messages about unknown axes and buttons. You can then go back to this class definition and use this information to add
controls until you&#8217;re not getting any of these &#8216;missing control&#8217; messages and everything&#8217;s working.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="api/rockcandy.html" class="btn btn-neutral" title="Rock Candy Controller Support" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Tom Oinn.
      Last updated on Apr 14, 2017.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0.3',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>