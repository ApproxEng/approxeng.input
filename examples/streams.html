

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Streaming Axis and Button Hold values &mdash; Approximate Engineering - Input 2.2.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    
      <link rel="search" type="application/opensearchdescription+xml" title="Search within Approximate Engineering - Input 2.2.0 documentation" href="../_static/opensearch.xml"/>
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  

  
    <link rel="top" title="Approximate Engineering - Input 2.2.0 documentation" href="../index.html"/>
        <link rel="up" title="Examples" href="../examples.html"/>
        <link rel="next" title="Tiny4WD Robot Drive" href="tiny4wd.html"/>
        <link rel="prev" title="Showing Controller Properties" href="show_controls.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html" class="fa fa-home"> Approximate Engineering - Input</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Change Log</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#version-2-2-0">Version 2.2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#version-2-1-0">Version 2.1.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#version-2-0-3-2-0-4">Version 2.0.3, 2.0.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#version-2-0-2">Version 2.0.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#version-2-0-1">Version 2.0.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#version-2-0-0">Version 2.0.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#version-1-0-7">Version 1.0.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#version-1-0-6">Version 1.0.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#version-1-0-5">Version 1.0.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#version-1-0-4">Version 1.0.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#version-1-0-2">Version 1.0.2</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../simpleusage.html">Simple Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../simpleusage.html#connecting-to-a-controller">Connecting to a controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simpleusage.html#reading-analogue-axes">Reading Analogue Axes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simpleusage.html#checking-for-held-buttons">Checking for Held Buttons</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simpleusage.html#reading-multiple-axis-or-button-hold-values">Reading multiple Axis or Button Hold values</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simpleusage.html#querying-button-presses">Querying Button Presses</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../simpleusage.html#standard-names">Standard Names</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../simpleusage.html#button-names">Button Names</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simpleusage.html#axis-names">Axis Names</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../bluetooth.html">Pairing Controllers over Bluetooth</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../bluetooth.html#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bluetooth.html#pairing-with-bluetoothctl">Pairing with Bluetoothctl</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/input.html">Common APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/selectbinder.html">Binding - approxeng.input.selectbinder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/dualshock3.html">PlayStation 3 Controller Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/dualshock4.html">PlayStation 4 Controller Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/xboxone.html">XBox-One S Controller Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/rockcandy.html">Rock Candy Controller Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/steamcontroller.html">Steam Controller Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/wii.html">Wii Remote Pro Controller Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/wiimote.html">WiiMote Controller Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/pihut.html">PiHut Controller Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/sf30pro.html">8Bitdo SF30Pro/SN30Pro Controller Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/spacemousepro.html">Wired SpaceMouse Pro Support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../addingcontrollers.html">Adding support for a new controller type</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../addingcontrollers.html#finding-your-product-and-vendor-id">Finding your product and vendor ID</a></li>
<li class="toctree-l2"><a class="reference internal" href="../addingcontrollers.html#clones-of-a-supported-controller">Clones of a supported controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../addingcontrollers.html#writing-a-new-controller-class">Writing a new controller class</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="camjam.html">CamJam Edukit 3 Robot</a></li>
<li class="toctree-l2"><a class="reference internal" href="failover.html">Controller Failover</a></li>
<li class="toctree-l2"><a class="reference internal" href="show_controls.html">Showing Controller Properties</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Streaming Axis and Button Hold values</a></li>
<li class="toctree-l2"><a class="reference internal" href="tiny4wd.html">Tiny4WD Robot Drive</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../howtouse.html">Advanced Usage Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../howtouse.html#constructing-and-binding-a-controller">Constructing and Binding a Controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howtouse.html#handling-buttons">Handling Buttons</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howtouse.html#more-about-analogue-axes">More about Analogue Axes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../sys.html">LEDs and Battery Monitoring</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../sys.html#enabling-access-to-leds">Enabling access to LEDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sys.html#writing-to-leds">Writing to LEDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sys.html#reading-battery-levels">Reading Battery Levels</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Approximate Engineering - Input</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../examples.html">Examples</a> &raquo;</li>
      
    <li>Streaming Axis and Button Hold values</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="streaming-axis-and-button-hold-values">
<span id="example-stream"></span><h1>Streaming Axis and Button Hold values<a class="headerlink" href="#streaming-axis-and-button-hold-values" title="Permalink to this headline">Â¶</a></h1>
<p>Some other APIs, most notably <a class="reference external" href="http://gpiozero.readthedocs.io/en/stable/index.html">Gpiozero</a>, can configure devices to read from iterators over data such as axis values. To
use this facility we need to be able to produce generators (iterators which work over lazily evaluated, potentially
infinite, sets of data) containing streams of axis and button hold values. These generators can then be set as the
source for anything in e.g. Gpiozero which has a <a class="reference external" href="http://gpiozero.readthedocs.io/en/stable/api_generic.html#sourcemixin">SourceMixin</a> defined, including motors and similar.</p>
<p>The example below doesn&#8217;t use Gpiozero, but instead shows how a stream of x,y values from the left analogue stick is
created, then used by an infinite loop to print those values. The loop only exits with a StopIteration exception when
the controller disconnects. This is also an example of explicitly creating and binding a controller, rather than using
the resource abstraction shown in the other examples.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="kn">from</span> <span class="nn">approxeng.input.controllers</span> <span class="kn">import</span> <span class="n">find_matching_controllers</span><span class="p">,</span> <span class="n">ControllerRequirement</span>
<span class="kn">from</span> <span class="nn">approxeng.input.selectbinder</span> <span class="kn">import</span> <span class="n">bind_controllers</span>

<span class="n">discovery</span> <span class="o">=</span> <span class="bp">None</span>

<span class="c1"># Look for an attached controller, requiring that it has &#39;lx&#39; and &#39;ly&#39; controls, looping until we find one.</span>
<span class="k">while</span> <span class="n">discovery</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">discovery</span> <span class="o">=</span> <span class="n">find_matching_controllers</span><span class="p">(</span><span class="n">ControllerRequirement</span><span class="p">(</span><span class="n">require_snames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lx&#39;</span><span class="p">,</span> <span class="s1">&#39;ly&#39;</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;No suitable controller found yet&#39;</span><span class="p">)</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Bind the controller to the underlying event stream, returning a function used to tidy up</span>
<span class="n">unbind_function</span> <span class="o">=</span> <span class="n">bind_controllers</span><span class="p">(</span><span class="n">discovery</span><span class="p">,</span> <span class="n">print_events</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Get a stream of values for the left stick x and y axes. If we were using robot code from gpio.zero we could</span>
    <span class="c1"># set the controller.stream[...] as a source, as sources are just iterators which produce sequences of values</span>
    <span class="k">for</span> <span class="n">lx</span><span class="p">,</span> <span class="n">ly</span> <span class="ow">in</span> <span class="n">discovery</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">stream</span><span class="p">[</span><span class="s1">&#39;lx&#39;</span><span class="p">,</span> <span class="s1">&#39;ly&#39;</span><span class="p">]:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Left stick: x={}, y={}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lx</span><span class="p">,</span> <span class="n">ly</span><span class="p">))</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
    <span class="c1"># Raised when the stream ends</span>
    <span class="k">pass</span>

<span class="c1"># Tidy up any resources (threads, file handles) used by the binder</span>
<span class="n">unbind_function</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>Note particularly that there&#8217;s only one call to create the stream, on line 21, and that afterwards this is just like any
other iterable thing in Python, each time around the loop the next value (in this case a tuple of lx and ly axis values)
is taken off the stream.</p>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tiny4wd.html" class="btn btn-neutral float-right" title="Tiny4WD Robot Drive">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="show_controls.html" class="btn btn-neutral" title="Showing Controller Properties"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Tom Oinn.
      Last updated on Feb 11, 2019.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>