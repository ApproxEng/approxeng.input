

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Pairing Controllers over Bluetooth &mdash; Approximate Engineering - Input 2.2.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    
      <link rel="search" type="application/opensearchdescription+xml" title="Search within Approximate Engineering - Input 2.2.0 documentation" href="_static/opensearch.xml"/>
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  

  
    <link rel="top" title="Approximate Engineering - Input 2.2.0 documentation" href="index.html"/>
        <link rel="next" title="API Documentation" href="api.html"/>
        <link rel="prev" title="Simple Usage" href="simpleusage.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="index.html" class="fa fa-home"> Approximate Engineering - Input</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change Log</a><ul>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-2-2-0">Version 2.2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-2-1-0">Version 2.1.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-2-0-3-2-0-4">Version 2.0.3, 2.0.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-2-0-2">Version 2.0.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-2-0-1">Version 2.0.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-2-0-0">Version 2.0.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-1-0-7">Version 1.0.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-1-0-6">Version 1.0.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-1-0-5">Version 1.0.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-1-0-4">Version 1.0.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-1-0-2">Version 1.0.2</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="simpleusage.html">Simple Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="simpleusage.html#connecting-to-a-controller">Connecting to a controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="simpleusage.html#reading-analogue-axes">Reading Analogue Axes</a></li>
<li class="toctree-l2"><a class="reference internal" href="simpleusage.html#checking-for-held-buttons">Checking for Held Buttons</a></li>
<li class="toctree-l2"><a class="reference internal" href="simpleusage.html#reading-multiple-axis-or-button-hold-values">Reading multiple Axis or Button Hold values</a></li>
<li class="toctree-l2"><a class="reference internal" href="simpleusage.html#querying-button-presses">Querying Button Presses</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="simpleusage.html#standard-names">Standard Names</a><ul>
<li class="toctree-l2"><a class="reference internal" href="simpleusage.html#button-names">Button Names</a></li>
<li class="toctree-l2"><a class="reference internal" href="simpleusage.html#axis-names">Axis Names</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Pairing Controllers over Bluetooth</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pairing-with-bluetoothctl">Pairing with Bluetoothctl</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api/input.html">Common APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/selectbinder.html">Binding - approxeng.input.selectbinder</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/dualshock3.html">PlayStation 3 Controller Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/dualshock4.html">PlayStation 4 Controller Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/xboxone.html">XBox-One S Controller Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/rockcandy.html">Rock Candy Controller Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/steamcontroller.html">Steam Controller Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/wii.html">Wii Remote Pro Controller Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/wiimote.html">WiiMote Controller Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/pihut.html">PiHut Controller Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/sf30pro.html">8Bitdo SF30Pro/SN30Pro Controller Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/spacemousepro.html">Wired SpaceMouse Pro Support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="addingcontrollers.html">Adding support for a new controller type</a><ul>
<li class="toctree-l2"><a class="reference internal" href="addingcontrollers.html#finding-your-product-and-vendor-id">Finding your product and vendor ID</a></li>
<li class="toctree-l2"><a class="reference internal" href="addingcontrollers.html#clones-of-a-supported-controller">Clones of a supported controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="addingcontrollers.html#writing-a-new-controller-class">Writing a new controller class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="examples/camjam.html">CamJam Edukit 3 Robot</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/failover.html">Controller Failover</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/show_controls.html">Showing Controller Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/streams.html">Streaming Axis and Button Hold values</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/tiny4wd.html">Tiny4WD Robot Drive</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="howtouse.html">Advanced Usage Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="howtouse.html#constructing-and-binding-a-controller">Constructing and Binding a Controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtouse.html#handling-buttons">Handling Buttons</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtouse.html#more-about-analogue-axes">More about Analogue Axes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sys.html">LEDs and Battery Monitoring</a><ul>
<li class="toctree-l2"><a class="reference internal" href="sys.html#enabling-access-to-leds">Enabling access to LEDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="sys.html#writing-to-leds">Writing to LEDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="sys.html#reading-battery-levels">Reading Battery Levels</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Approximate Engineering - Input</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Pairing Controllers over Bluetooth</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="pairing-controllers-over-bluetooth">
<span id="bluetooth"></span><h1>Pairing Controllers over Bluetooth<a class="headerlink" href="#pairing-controllers-over-bluetooth" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The XBox One S controller is the only XBox controller with bluetooth support. This won&#8217;t work for regular (older)
XBox wireless controllers. In addition, there&#8217;s a bit of setup required before the bluetooth stack will stay
connected to the controller, see <a class="reference internal" href="api/xboxone.html#api-xboxone"><span>XBox-One S Controller Support</span></a> for instructions.</p>
</div>
<p>This guide will show you how to discover and pair with a bluetooth device entirely using the command line. Because this
is a one-time process (controllers will, once paired, connect automatically) you could use the graphical tools to pair
the controller in the first place, but I prefer to run everything on my robots without a display so this is how I do it.</p>
<div class="section" id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<p>A standard Raspberry Pi will now come with the necessary bluetooth services installed and running, largely because both
the Pi3 and Pi Zero W have built-in bluetooth and wifi chips. This guide assumes you&#8217;re using one of these newer
versions, if you aren&#8217;t you may need to explicitly install the bluetooth stack:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>pi@raspberrypi ~ $ sudo apt-get install bluetooth libbluetooth3 libusb-dev
pi@raspberrypi ~ $ sudo systemctl <span class="nb">enable</span> bluetooth.service
pi@raspberrypi ~ $ sudo usermod -G bluetooth -a pi
</pre></div>
</div>
<p>If you have to do the above, you should power cycle your pi, don&#8217;t just restart it. It might be okay, but you&#8217;ll make
life more predictable by actually pulling the plug and waiting a few seconds.</p>
</div>
<div class="section" id="pairing-with-bluetoothctl">
<h2>Pairing with Bluetoothctl<a class="headerlink" href="#pairing-with-bluetoothctl" title="Permalink to this headline">¶</a></h2>
<p>Once you have a working bluetooth stack, you can use the bluetoothctl command to configure it. You don&#8217;t need to run
this as root, just use your regular user account.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>pi@raspberrypi ~ $ bluetoothctl
</pre></div>
</div>
<p>This will put you into a shell-like mode where you can type commands to manipulate the bluetooth stack. It will also
show messages related to connections, controllers (in this context a controller is a bluetooth master, you&#8217;ll normally
only have one of these), pairing, scans etc.</p>
<p>The first thing you should do is enable the default agent. The agent is the code which handles pairing requests, and is
necessary to successfully pair with devices which don&#8217;t have displays or pairing codes. Once you have the bluetoothctl
shell open, type the following (expected responses from bluetoothctl are shown):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>bluetooth<span class="o">]</span><span class="c1"># agent on</span>
Agent registered
<span class="o">[</span>bluetooth<span class="o">]</span><span class="c1"># default-agent</span>
Default agent request successful
</pre></div>
</div>
<p>The next step is to start a bluetooth scan. This is used to discover devices which are either connected already or which
are ready to pair. You need to do this in conjunction with putting your device into pairing mode (the exact mechanism
for this varies from device to device, for example on the XBox One controller you hold down the share button while
pressing the home one, but look up the specifics for your particular controller).</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>bluetooth<span class="o">]</span><span class="c1"># scan on</span>
Discovery started
<span class="o">[</span>CHG<span class="o">]</span> Controller 5C:F3:70:66:5C:E2 Discovering: yes
.... Messages about devices will follow here
</pre></div>
</div>
<p>You need to look for messages about your device. Devices are identified by MAC addresses; six part hexadecimal IDs
unique to that particular device. The controller (the bluetooth chipset on your pi) also has a MAC address, in my case
this is the &#8216;5C:F3:70:66:5C:E2&#8217; part in the above example, yours will be different.</p>
<p>Once you have your device address, you need to issue a &#8216;pair&#8217;, &#8216;connect&#8217; and &#8216;trust&#8217; command, to pair with the device,
connect to its services, and to tell the agent that it should trust the device automatically in the future and allow it
to pair with no further checks. You may be asked to confirm these processes (in my example below I&#8217;m not because I had
already trusted the device before un-pairing and re-pairing for the example, but if it does just do what it says on the
console).</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>.... after running the <span class="s1">&#39;scan on&#39;</span> and telling my XBox controller to enter pairing mode
<span class="o">[</span>NEW<span class="o">]</span> Device C8:3F:26:1E:C3:7F Xbox Wireless Controller
<span class="o">[</span>bluetooth<span class="o">]</span><span class="c1"># pair C8:3F:26:1E:C3:7F</span>
Attempting to pair with C8:3F:26:1E:C3:7F
<span class="o">[</span>CHG<span class="o">]</span> Device C8:3F:26:1E:C3:7F Connected: yes
<span class="o">[</span>CHG<span class="o">]</span> Device C8:3F:26:1E:C3:7F Modalias: usb:v045Ep02E0d0903
<span class="o">[</span>CHG<span class="o">]</span> Device C8:3F:26:1E:C3:7F UUIDs: <span class="m">00001124</span>-0000-1000-8000-00805f9b34fb
<span class="o">[</span>CHG<span class="o">]</span> Device C8:3F:26:1E:C3:7F UUIDs: <span class="m">00001200</span>-0000-1000-8000-00805f9b34fb
<span class="o">[</span>CHG<span class="o">]</span> Device C8:3F:26:1E:C3:7F ServicesResolved: yes
<span class="o">[</span>CHG<span class="o">]</span> Device C8:3F:26:1E:C3:7F Paired: yes
Pairing successful
<span class="o">[</span>CHG<span class="o">]</span> Device C8:3F:26:1E:C3:7F ServicesResolved: no
<span class="o">[</span>CHG<span class="o">]</span> Device C8:3F:26:1E:C3:7F Connected: no
<span class="o">[</span>bluetooth<span class="o">]</span><span class="c1"># connect C8:3F:26:1E:C3:7F</span>
Attempting to connect to C8:3F:26:1E:C3:7F
<span class="o">[</span>CHG<span class="o">]</span> Device C8:3F:26:1E:C3:7F Connected: yes
Connection successful
<span class="o">[</span>CHG<span class="o">]</span> Device C8:3F:26:1E:C3:7F ServicesResolved: yes
<span class="o">[</span>Xbox Wireless Controller<span class="o">]</span><span class="c1"># trust C8:3F:26:1E:C3:7F</span>
<span class="o">[</span>CHG<span class="o">]</span> Device C8:3F:26:1E:C3:7F Trusted: yes
Changing C8:3F:26:1E:C3:7F trust succeeded
<span class="o">[</span>CHG<span class="o">]</span> Device <span class="m">54</span>:60:09:ED:2E:2F RSSI: -81
<span class="o">[</span>CHG<span class="o">]</span> Device <span class="m">54</span>:60:09:ED:2E:2F RSSI: -89
<span class="o">[</span>Xbox Wireless Controller<span class="o">]</span><span class="c1">#</span>
</pre></div>
</div>
<p>You can now exit bluetoothctl by pressing CTRL-D or typing &#8216;quit&#8217; into the shell.</p>
<p>From now on, your controller (the XBox One S controller in my example) will pair automatically with the bluetooth
adapter on your pi (or other machine if you&#8217;ve configured it). Note that if you&#8217;re using a bluetooth dongle, the pairing
will have to be re-done if you move the dongle to another computer, so you can&#8217;t, say, configure a dongle on a linux
desktop and expect it to just work if you move it to your pi.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api.html" class="btn btn-neutral float-right" title="API Documentation">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="simpleusage.html" class="btn btn-neutral" title="Simple Usage"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Tom Oinn.
      Last updated on Feb 11, 2019.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>