<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Controller Failover &mdash; Approximate Engineering - Input 2.6.4 documentation</title>
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/documentation_options.js?v=5248d183"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Approximate Engineering - Input 2.6.4 documentation"
          href="../_static/opensearch.xml"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Streaming Axis and Button Hold values" href="streams.html" />
    <link rel="prev" title="CamJam Edukit 3 Robot" href="camjam.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Approximate Engineering - Input
          </a>
              <div class="version">
                2.6.4
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../simpleusage.html">Simple Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../simpleusage.html#standard-names">Standard Names</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commandline.html">Command-line tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bluetooth.html">Pairing Controllers over Bluetooth</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profiling.html">Profiling and Testing Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../addingcontrollers.html">Adding support for a new controller type</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="camjam.html">CamJam Edukit 3 Robot</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Controller Failover</a></li>
<li class="toctree-l2"><a class="reference internal" href="streams.html">Streaming Axis and Button Hold values</a></li>
<li class="toctree-l2"><a class="reference internal" href="tiny4wd.html">Tiny4WD Robot Drive</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../howtouse.html">Advanced Usage Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sys.html">LEDs and Battery Monitoring</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Approximate Engineering - Input</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../examples.html">Examples</a></li>
      <li class="breadcrumb-item active">Controller Failover</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="controller-failover">
<span id="example-failover"></span><h1>Controller Failover<a class="headerlink" href="#controller-failover" title="Link to this heading">¶</a></h1>
<p>New in version 1.0.7 is the ability to detect when a controller has disconnected. This means you can write code which will
not only wait for a controller, but will gracefully handle the controller failing (generally from going out of range or
batteries dying!). Because the simplest form of the controller resource or explicit binding will bind to any available
controller, you can easily make your robot able to switch from one controller to another without any extra code. PS4
controller battery dead? No problem, just turn on your spare one, or even your spare XBox1 controller that you had in
your bag for some reason. As long as the controller has been previously paired with the Pi (or other computer) it’ll be
possible for your code to find it.</p>
<p>The example below waits for a controller, prints some details about it, then goes into a loop where it prints the values
of any active (non-zero) axes, along with any buttons that are pressed. If you disconnect the controller, the code will
detect this and go back into the search mode. If you then (or previously) pair another controller it’ll go back into the
loop, and so on.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="c1"># All we need is a single import.</span>
<span class="linenos"> 4</span><span class="kn">from</span> <span class="nn">approxeng.input.selectbinder</span> <span class="kn">import</span> <span class="n">ControllerResource</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos"> 7</span>    <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 8</span>        <span class="c1"># Attempt to acquire a controller. If there&#39;s more than one we&#39;ll get one of them, if there aren&#39;t</span>
<span class="linenos"> 9</span>        <span class="c1"># any we&#39;ll throw an IOError. Assuming we succeed, the controller will be initialised, a new thread will be</span>
<span class="linenos">10</span>        <span class="c1"># created in the background to pull events out of evdev and update the state of the controller object, and all</span>
<span class="linenos">11</span>        <span class="c1"># the buttons and axes will be available as properties of &#39;controller&#39;</span>
<span class="linenos">12</span>        <span class="c1">#</span>
<span class="linenos">13</span>        <span class="c1"># For most controllers, the same driver class can be used whether the controller is connected over bluetooth or</span>
<span class="linenos">14</span>        <span class="c1"># over a USB cable. For controllers where this isn&#39;t the case there will be different driver classes for each</span>
<span class="linenos">15</span>        <span class="c1"># kind of connection. In this particular case we&#39;re binding to whatever controllers we can find rather than</span>
<span class="linenos">16</span>        <span class="c1"># specifying a particular one.</span>
<span class="linenos">17</span>        <span class="c1">#</span>
<span class="linenos">18</span>        <span class="c1"># The print_events can be set to show evdev events as they&#39;re received, whether handled or not. Any additional</span>
<span class="linenos">19</span>        <span class="c1"># keyword args are passed through to the constructor of the controller class, so if you know exactly what class</span>
<span class="linenos">20</span>        <span class="c1"># you&#39;re using (because you&#39;ve supplied a controller_class argument here) you can provide controller-specific</span>
<span class="linenos">21</span>        <span class="c1"># configuration in your resource. Setting controller_class to None just means &#39;find whatever joystick you can&#39;</span>
<span class="linenos">22</span>        <span class="k">with</span> <span class="n">ControllerResource</span><span class="p">(</span><span class="n">print_events</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hot_zone</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">dead_zone</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span> <span class="k">as</span> <span class="n">controller</span><span class="p">:</span>
<span class="linenos">23</span>
<span class="linenos">24</span>            <span class="c1"># We&#39;ve got a joystick, loop until it goes away. Print some details about the controller to the console.</span>
<span class="linenos">25</span>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Found a controller, </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">controller</span><span class="p">))</span>
<span class="linenos">26</span>
<span class="linenos">27</span>            <span class="c1"># New in version 1.0.7 is detection for when a controller disconnects. This is handy, because it means we</span>
<span class="linenos">28</span>            <span class="c1"># know if your robot has run out of controller range (for example) and can stop it! Rather than looping</span>
<span class="linenos">29</span>            <span class="c1"># while True we loop while the &#39;connected&#39; property on the controller is true.</span>
<span class="linenos">30</span>            <span class="k">while</span> <span class="n">controller</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
<span class="linenos">31</span>
<span class="linenos">32</span>                <span class="c1"># The next line is used to extract all buttons which were pressed since the last time this call was</span>
<span class="linenos">33</span>                <span class="c1"># made. This means you don&#39;t have to worry about whether you&#39;re catching buttons while they&#39;re held</span>
<span class="linenos">34</span>                <span class="c1"># down - this will catch a case where you check, then the user clicks and releases the button, and then</span>
<span class="linenos">35</span>                <span class="c1"># you check again. Even though the click happened while your code was off doing something else, the</span>
<span class="linenos">36</span>                <span class="c1"># event handling thread has monitored it and stored that the click happened. You can use methods on the</span>
<span class="linenos">37</span>                <span class="c1"># approxeng.input.ButtonPresses instance this returns to query for specific buttons (by their standard</span>
<span class="linenos">38</span>                <span class="c1"># name) or as in this case to see whether anything was pressed and print out the list of presses if so.</span>
<span class="linenos">39</span>                <span class="n">button_presses</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">check_presses</span><span class="p">()</span>
<span class="linenos">40</span>                <span class="k">if</span> <span class="n">button_presses</span><span class="o">.</span><span class="n">has_presses</span><span class="p">:</span>
<span class="linenos">41</span>                    <span class="c1"># Printing the ButtonPresses object prints a list of the snames of buttons which were pressed</span>
<span class="linenos">42</span>                    <span class="nb">print</span><span class="p">(</span><span class="n">button_presses</span><span class="p">)</span>
<span class="linenos">43</span>
<span class="linenos">44</span>                <span class="c1"># The controller.axes property contains all analogue (and potentially digital) axes of your controller.</span>
<span class="linenos">45</span>                <span class="c1"># As with the button presses these are updated behind the scenes, with dead and hot zones applied,</span>
<span class="linenos">46</span>                <span class="c1"># centre and range calibration and normalisation to either -1 to 1 (for centred axes) or 0 to 1 for</span>
<span class="linenos">47</span>                <span class="c1"># triggers. The convenience method active_axes will return all axis objects which aren&#39;t at their</span>
<span class="linenos">48</span>                <span class="c1"># resting position, but you can use other methods on this to get the corrected value for a specific</span>
<span class="linenos">49</span>                <span class="c1"># axis.</span>
<span class="linenos">50</span>                <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="n">controller</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">active_axes</span><span class="p">:</span>
<span class="linenos">51</span>                    <span class="c1"># Printing an axis object (CentredAxis, TriggerAxis or BinaryAxis) will print a summary of the</span>
<span class="linenos">52</span>                    <span class="c1"># axis including its current corrected value</span>
<span class="linenos">53</span>                    <span class="nb">print</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
<span class="linenos">54</span>
<span class="linenos">55</span>                <span class="c1"># Note - in real cases we probably want to get axis values even when they&#39;re not active, in which case</span>
<span class="linenos">56</span>                <span class="c1"># we would use the methods on the Controller class to get single or multiple corrected axis values by</span>
<span class="linenos">57</span>                <span class="c1"># standard name.</span>
<span class="linenos">58</span>
<span class="linenos">59</span>                <span class="c1"># Sleep for a tenth of a second - spamming the console with print messages can upset the event reading</span>
<span class="linenos">60</span>                <span class="c1"># loop. In real cases your code will be off doing other things and you probably won&#39;t want to have</span>
<span class="linenos">61</span>                <span class="c1"># explicit delays!</span>
<span class="linenos">62</span>                <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
<span class="linenos">63</span>
<span class="linenos">64</span>            <span class="c1"># We get here if controller.connected is False, this is set by the binder if it at any point fails to talk</span>
<span class="linenos">65</span>            <span class="c1"># to the controller. The result is that if you turn your controller off you should see a disconnection</span>
<span class="linenos">66</span>            <span class="c1"># message and the code will go back into looking for controllers.</span>
<span class="linenos">67</span>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Controller disconnected!&#39;</span><span class="p">)</span>
<span class="linenos">68</span>
<span class="linenos">69</span>    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
<span class="linenos">70</span>        <span class="c1"># This is thrown when attempting to create the controller resource if no controllers are present. In this case</span>
<span class="linenos">71</span>        <span class="c1"># we just pause for a second and try again.</span>
<span class="linenos">72</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Waiting for controller...&#39;</span><span class="p">)</span>
<span class="linenos">73</span>        <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="camjam.html" class="btn btn-neutral float-left" title="CamJam Edukit 3 Robot" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="streams.html" class="btn btn-neutral float-right" title="Streaming Axis and Button Hold values" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017 to 2024 Tom Oinn.
      <span class="lastupdated">Last updated on Feb 15, 2024.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>