

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tiny4WD Robot Drive &mdash; Approximate Engineering - Input 2.4.3 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Approximate Engineering - Input 2.4.3 documentation"
          href="../_static/opensearch.xml"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Advanced Usage Guide" href="../howtouse.html" />
    <link rel="prev" title="Streaming Axis and Button Hold values" href="streams.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Approximate Engineering - Input
          

          
          </a>

          
            
            
              <div class="version">
                2.4.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../simpleusage.html">Simple Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../simpleusage.html#standard-names">Standard Names</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bluetooth.html">Pairing Controllers over Bluetooth</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../addingcontrollers.html">Adding support for a new controller type</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="camjam.html">CamJam Edukit 3 Robot</a></li>
<li class="toctree-l2"><a class="reference internal" href="failover.html">Controller Failover</a></li>
<li class="toctree-l2"><a class="reference internal" href="show_controls.html">Showing Controller Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="streams.html">Streaming Axis and Button Hold values</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Tiny4WD Robot Drive</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../howtouse.html">Advanced Usage Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sys.html">LEDs and Battery Monitoring</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Approximate Engineering - Input</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../examples.html">Examples</a> &raquo;</li>
        
      <li>Tiny4WD Robot Drive</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tiny4wd-robot-drive">
<span id="example-tiny4wd"></span><h1>Tiny4WD Robot Drive<a class="headerlink" href="#tiny4wd-robot-drive" title="Permalink to this headline">¶</a></h1>
<p>Tiny4WD is a great first robot kit designed by Brian Corteil (<a class="reference external" href="https://twitter.com/cannonfodder">&#64;CannonFodder</a> and
<a class="reference external" href="https://twitter.com/coretecrobotics">&#64;CoretecRobotics</a>). You can buy the kits from the lovely, if money-sucking,
pirates at <a class="reference external" href="https://twitter.com/pimoroni">&#64;pimoroni</a> from
<a class="reference external" href="https://shop.pimoroni.com/products/coretec-tiny-4wd-robot-rover">their online shop</a>. The code below shows, with a
few extra bits and pieces needed in case you’re running without the robot libraries, how to use this library to drive
it around. The left analogue stick controls the robot, and the HOME button exits.</p>
<img alt="../_images/tiny4wd.jpg" src="../_images/tiny4wd.jpg" />
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Code for Brian Corteil&#39;s Tiny 4WD robot, based on code from Brian as modified by Emma Norling.</span>
<span class="c1"># Subsequently modified by Tom Oinn to add dummy functions when no explorer hat is available,</span>
<span class="c1"># use any available joystick, use the new function in 1.0.6 of approxeng.input to get multiple</span>
<span class="c1"># axis values in a single call, use implicit de-structuring of tuples to reduce verbosity, add</span>
<span class="c1"># an exception to break out of the control loop on pressing HOME etc.</span>

<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Attempt to import the Explorer HAT library. If this fails, because we&#39;re running somewhere</span>
    <span class="c1"># that doesn&#39;t have the library, we create dummy functions for set_speeds and stop_motors which</span>
    <span class="c1"># just print out what they&#39;d have done. This is a fairly common way to deal with hardware that</span>
    <span class="c1"># may or may not exist! Obviously if you&#39;re actually running this on one of Brian&#39;s robots you</span>
    <span class="c1"># should have the Explorer HAT libraries installed, this is really just so I can test on my big</span>
    <span class="c1"># linux desktop machine when coding.</span>

    <span class="kn">from</span> <span class="nn">explorerhat</span> <span class="kn">import</span> <span class="n">motor</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Explorer HAT library available.&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">set_speeds</span><span class="p">(</span><span class="n">power_left</span><span class="p">,</span> <span class="n">power_right</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        As we have an motor hat, we can use the motors</span>
<span class="sd">        </span>
<span class="sd">        :param power_left: </span>
<span class="sd">            Power to send to left motor</span>
<span class="sd">        :param power_right: </span>
<span class="sd">            Power to send to right motor, will be inverted to reflect chassis layout</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">motor</span><span class="o">.</span><span class="n">one</span><span class="o">.</span><span class="n">speed</span><span class="p">(</span><span class="o">-</span><span class="n">power_right</span><span class="p">)</span>
        <span class="n">motor</span><span class="o">.</span><span class="n">two</span><span class="o">.</span><span class="n">speed</span><span class="p">(</span><span class="n">power_left</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">stop_motors</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        As we have an motor hat, stop the motors using their motors call</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">motor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No explorer HAT library available, using dummy functions.&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">set_speeds</span><span class="p">(</span><span class="n">power_left</span><span class="p">,</span> <span class="n">power_right</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        No motor hat - print what we would have sent to it if we&#39;d had one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Left: </span><span class="si">{}</span><span class="s1">, Right: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">power_left</span><span class="p">,</span> <span class="n">power_right</span><span class="p">))</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">stop_motors</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        No motor hat, so just print a message.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Motors stopping&#39;</span><span class="p">)</span>

<span class="c1"># All we need, as we don&#39;t care which controller we bind to, is the ControllerResource</span>
<span class="kn">from</span> <span class="nn">approxeng.input.selectbinder</span> <span class="kn">import</span> <span class="n">ControllerResource</span>


<span class="k">class</span> <span class="nc">RobotStopException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The simplest possible subclass of Exception, we&#39;ll raise this if we want to stop the robot</span>
<span class="sd">    for any reason. Creating a custom exception like this makes the code more readable later.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>


<span class="k">def</span> <span class="nf">mixer</span><span class="p">(</span><span class="n">yaw</span><span class="p">,</span> <span class="n">throttle</span><span class="p">,</span> <span class="n">max_power</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mix a pair of joystick axes, returning a pair of wheel speeds. This is where the mapping from</span>
<span class="sd">    joystick positions to wheel powers is defined, so any changes to how the robot drives should</span>
<span class="sd">    be made here, everything else is really just plumbing.</span>
<span class="sd">    </span>
<span class="sd">    :param yaw: </span>
<span class="sd">        Yaw axis value, ranges from -1.0 to 1.0</span>
<span class="sd">    :param throttle: </span>
<span class="sd">        Throttle axis value, ranges from -1.0 to 1.0</span>
<span class="sd">    :param max_power: </span>
<span class="sd">        Maximum speed that should be returned from the mixer, defaults to 100</span>
<span class="sd">    :return: </span>
<span class="sd">        A pair of power_left, power_right integer values to send to the motor driver</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left</span> <span class="o">=</span> <span class="n">throttle</span> <span class="o">+</span> <span class="n">yaw</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">throttle</span> <span class="o">-</span> <span class="n">yaw</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">max_power</span><span class="p">)</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">left</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">right</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">left</span> <span class="o">*</span> <span class="n">scale</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">right</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>


<span class="c1"># Outer try / except catches the RobotStopException we just defined, which we&#39;ll raise when we want to</span>
<span class="c1"># bail out of the loop cleanly, shutting the motors down. We can raise this in response to a button press</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># Inner try / except is used to wait for a controller to become available, at which point we</span>
        <span class="c1"># bind to it and enter a loop where we read axis values and send commands to the motors.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Bind to any available joystick, this will use whatever&#39;s connected as long as the library</span>
            <span class="c1"># supports it.</span>
            <span class="k">with</span> <span class="n">ControllerResource</span><span class="p">(</span><span class="n">dead_zone</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">hot_zone</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span> <span class="k">as</span> <span class="n">joystick</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Controller found, press HOME button to exit, use left stick to drive.&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">joystick</span><span class="o">.</span><span class="n">controls</span><span class="p">)</span>
                <span class="c1"># Loop until the joystick disconnects, or we deliberately stop by raising a</span>
                <span class="c1"># RobotStopException</span>
                <span class="k">while</span> <span class="n">joystick</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
                    <span class="c1"># Get joystick values from the left analogue stick</span>
                    <span class="n">x_axis</span><span class="p">,</span> <span class="n">y_axis</span> <span class="o">=</span> <span class="n">joystick</span><span class="p">[</span><span class="s1">&#39;lx&#39;</span><span class="p">,</span> <span class="s1">&#39;ly&#39;</span><span class="p">]</span>
                    <span class="c1"># Get power from mixer function</span>
                    <span class="n">power_left</span><span class="p">,</span> <span class="n">power_right</span> <span class="o">=</span> <span class="n">mixer</span><span class="p">(</span><span class="n">yaw</span><span class="o">=</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">throttle</span><span class="o">=</span><span class="n">y_axis</span><span class="p">)</span>
                    <span class="c1"># Set motor speeds</span>
                    <span class="n">set_speeds</span><span class="p">(</span><span class="n">power_left</span><span class="p">,</span> <span class="n">power_right</span><span class="p">)</span>
                    <span class="c1"># Get a ButtonPresses object containing everything that was pressed since the last</span>
                    <span class="c1"># time around this loop.</span>
                    <span class="n">joystick</span><span class="o">.</span><span class="n">check_presses</span><span class="p">()</span>
                    <span class="c1"># Print out any buttons that were pressed, if we had any</span>
                    <span class="k">if</span> <span class="n">joystick</span><span class="o">.</span><span class="n">has_presses</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">joystick</span><span class="o">.</span><span class="n">presses</span><span class="p">)</span>
                    <span class="c1"># If home was pressed, raise a RobotStopException to bail out of the loop</span>
                    <span class="c1"># Home is generally the PS button for playstation controllers, XBox for XBox etc</span>
                    <span class="k">if</span> <span class="s1">&#39;home&#39;</span> <span class="ow">in</span> <span class="n">joystick</span><span class="o">.</span><span class="n">presses</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">RobotStopException</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="c1"># We get an IOError when using the ControllerResource if we don&#39;t have a controller yet,</span>
            <span class="c1"># so in this case we just wait a second and try again after printing a message.</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No controller found yet&#39;</span><span class="p">)</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">except</span> <span class="n">RobotStopException</span><span class="p">:</span>
    <span class="c1"># This exception will be raised when the home button is pressed, at which point we should</span>
    <span class="c1"># stop the motors.</span>
    <span class="n">stop_motors</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../howtouse.html" class="btn btn-neutral float-right" title="Advanced Usage Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="streams.html" class="btn btn-neutral float-left" title="Streaming Axis and Button Hold values" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2017, 2018, 2019, 2020 Tom Oinn
      <span class="lastupdated">
        Last updated on Sep 11, 2020.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>