

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Adding support for a new controller type &mdash; Approximate Engineering - Input 2.2.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    
      <link rel="search" type="application/opensearchdescription+xml" title="Search within Approximate Engineering - Input 2.2.0 documentation" href="_static/opensearch.xml"/>
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  

  
    <link rel="top" title="Approximate Engineering - Input 2.2.0 documentation" href="index.html"/>
        <link rel="next" title="Examples" href="examples.html"/>
        <link rel="prev" title="Wired SpaceMouse Pro Support" href="api/spacemousepro.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="index.html" class="fa fa-home"> Approximate Engineering - Input</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change Log</a><ul>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-2-2-0">Version 2.2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-2-1-0">Version 2.1.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-2-0-3-2-0-4">Version 2.0.3, 2.0.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-2-0-2">Version 2.0.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-2-0-1">Version 2.0.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-2-0-0">Version 2.0.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-1-0-7">Version 1.0.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-1-0-6">Version 1.0.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-1-0-5">Version 1.0.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-1-0-4">Version 1.0.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-1-0-2">Version 1.0.2</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="simpleusage.html">Simple Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="simpleusage.html#connecting-to-a-controller">Connecting to a controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="simpleusage.html#reading-analogue-axes">Reading Analogue Axes</a></li>
<li class="toctree-l2"><a class="reference internal" href="simpleusage.html#checking-for-held-buttons">Checking for Held Buttons</a></li>
<li class="toctree-l2"><a class="reference internal" href="simpleusage.html#reading-multiple-axis-or-button-hold-values">Reading multiple Axis or Button Hold values</a></li>
<li class="toctree-l2"><a class="reference internal" href="simpleusage.html#querying-button-presses">Querying Button Presses</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="simpleusage.html#standard-names">Standard Names</a><ul>
<li class="toctree-l2"><a class="reference internal" href="simpleusage.html#button-names">Button Names</a></li>
<li class="toctree-l2"><a class="reference internal" href="simpleusage.html#axis-names">Axis Names</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="bluetooth.html">Pairing Controllers over Bluetooth</a><ul>
<li class="toctree-l2"><a class="reference internal" href="bluetooth.html#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="bluetooth.html#pairing-with-bluetoothctl">Pairing with Bluetoothctl</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api/input.html">Common APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/selectbinder.html">Binding - approxeng.input.selectbinder</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/dualshock3.html">PlayStation 3 Controller Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/dualshock4.html">PlayStation 4 Controller Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/xboxone.html">XBox-One S Controller Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/rockcandy.html">Rock Candy Controller Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/steamcontroller.html">Steam Controller Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/wii.html">Wii Remote Pro Controller Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/wiimote.html">WiiMote Controller Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/pihut.html">PiHut Controller Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/sf30pro.html">8Bitdo SF30Pro/SN30Pro Controller Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/spacemousepro.html">Wired SpaceMouse Pro Support</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Adding support for a new controller type</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#finding-your-product-and-vendor-id">Finding your product and vendor ID</a></li>
<li class="toctree-l2"><a class="reference internal" href="#clones-of-a-supported-controller">Clones of a supported controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="#writing-a-new-controller-class">Writing a new controller class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="examples/camjam.html">CamJam Edukit 3 Robot</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/failover.html">Controller Failover</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/show_controls.html">Showing Controller Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/streams.html">Streaming Axis and Button Hold values</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples/tiny4wd.html">Tiny4WD Robot Drive</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="howtouse.html">Advanced Usage Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="howtouse.html#constructing-and-binding-a-controller">Constructing and Binding a Controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtouse.html#handling-buttons">Handling Buttons</a></li>
<li class="toctree-l2"><a class="reference internal" href="howtouse.html#more-about-analogue-axes">More about Analogue Axes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sys.html">LEDs and Battery Monitoring</a><ul>
<li class="toctree-l2"><a class="reference internal" href="sys.html#enabling-access-to-leds">Enabling access to LEDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="sys.html#writing-to-leds">Writing to LEDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="sys.html#reading-battery-levels">Reading Battery Levels</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Approximate Engineering - Input</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Adding support for a new controller type</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="adding-support-for-a-new-controller-type">
<h1>Adding support for a new controller type<a class="headerlink" href="#adding-support-for-a-new-controller-type" title="Permalink to this headline">¶</a></h1>
<p>The library supports a number of controllers but it&#8217;s quite possible, given the variety of cheap clones on the market,
that your particular controller isn&#8217;t one of them. You have a few options, depending on the scenario you find yourself
in. Firstly though you&#8217;ll need both product and vendor IDs for your device - these are allocated by the USB consortium
so will definitely not be the same for a clone device as for an original one, for example.</p>
<div class="section" id="finding-your-product-and-vendor-id">
<h2>Finding your product and vendor ID<a class="headerlink" href="#finding-your-product-and-vendor-id" title="Permalink to this headline">¶</a></h2>
<p>Once you have a controller paired over bluetooth, or, in the case of those with specific dongles, otherwise connected,
you can run the <cite>scripts/list_devices.py</cite> to print out a list of all connected devices, including the vendor and product
identifiers. For example, with my XBox One controller paired and connected I see this:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">(</span>viridia-env<span class="o">)</span> tom@Ogre ~/git/approxeng.input/scripts $ python list_devices.py
<span class="o">{</span> <span class="s1">&#39;bus&#39;</span>: <span class="m">5</span>,
  <span class="s1">&#39;fn&#39;</span>: <span class="s1">&#39;/dev/input/event14&#39;</span>,
  <span class="s1">&#39;name&#39;</span>: <span class="s1">&#39;Xbox Wireless Controller&#39;</span>,
  <span class="s1">&#39;phys&#39;</span>: <span class="s1">&#39;5c:f3:70:66:5c:e2&#39;</span>,
  <span class="s1">&#39;product&#39;</span>: <span class="m">736</span>,
  <span class="s1">&#39;vendor&#39;</span>: <span class="m">1118</span>,
  <span class="s1">&#39;version&#39;</span>: <span class="m">2307</span><span class="o">}</span>
</pre></div>
</div>
<p>In general this should show you enough information to identify the controller you&#8217;ve just connected and get the details.</p>
</div>
<div class="section" id="clones-of-a-supported-controller">
<h2>Clones of a supported controller<a class="headerlink" href="#clones-of-a-supported-controller" title="Permalink to this headline">¶</a></h2>
<p>If you have a controller which is an exact copy of one the library supports, but isn&#8217;t autodetected, you can either bind
it yourself, using the class from the library which most closely matches your controller, or you can add autodetect
support to the library, again using the existing class. This might happen if you have, say, a clone PS4 controller which
is identical in every way but which has a different USB vendor and product identifier.</p>
<p>The <code class="xref py py-const docutils literal"><span class="pre">approxeng.input.controllers.CONTROLLERS</span></code> is an array of dicts containing class constructor, vendor ID and
product ID values. This array is searched for matching controllers when a controller class is specified, when no class
is provided this array is used to find any potential matches. If you add an appropriate entry to this array you can
cause the library&#8217;s controller matching to match an existing class with a new pair of vendor and product IDs. So,
supposing you had a new controller which used the <code class="xref py py-class docutils literal"><span class="pre">approxeng.input.dualshock4.DualShock4</span></code> codes for axes and
buttons, but had a different vendor and product ID, you could add it to the match array with:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">approxeng.input.controllers</span>
<span class="kn">from</span> <span class="nn">approxeng.input.dualshock4</span> <span class="kn">import</span> <span class="n">DualShock4</span>

<span class="n">VENDOR_ID</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">PRODUCT_ID</span> <span class="o">=</span> <span class="o">...</span>

<span class="n">approxeng</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">controllers</span><span class="o">.</span><span class="n">CONTROLLERS</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;constructor&#39;</span><span class="p">:</span> <span class="n">DualShock4</span><span class="p">,</span>
                                                <span class="s1">&#39;vendor_id&#39;</span><span class="p">:</span> <span class="n">VENDOR_ID</span><span class="p">,</span>
                                                <span class="s1">&#39;product_id&#39;</span><span class="p">:</span> <span class="n">PRODUCT_ID</span><span class="p">})</span>
</pre></div>
</div>
<p>This will now let you bind using the <cite>controller_class</cite> or no-argument form of the resource and should match your
controller&#8217;s vendor and product IDs to the existing controller class.</p>
</div>
<div class="section" id="writing-a-new-controller-class">
<h2>Writing a new controller class<a class="headerlink" href="#writing-a-new-controller-class" title="Permalink to this headline">¶</a></h2>
<p>It&#8217;s possible you have a controller which is completely different to the ones the library already supports. This might
be because it&#8217;s something we&#8217;ve just never got our hands on, or because the manufacturer has decided to produce a clone
controller with completely different codes for buttons or axes (it happens!). In this case you&#8217;ll need to create a new
subclass of <code class="xref py py-class docutils literal"><span class="pre">approxeng.input.Controller</span></code> and use the mechanism above to register it. Fortunately this is fairly
simple. First create your class, this won&#8217;t include any button or axis bindings, we&#8217;ll add these later:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">approxeng.input</span> <span class="kn">import</span> <span class="n">Controller</span>

<span class="n">MY_VENDOR_ID</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">MY_PRODUCT_ID</span> <span class="o">=</span> <span class="o">...</span>


<span class="k">class</span> <span class="nc">MyNewController</span><span class="p">(</span><span class="n">Controller</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Driver for my new controller type</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dead_zone</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">hot_zone</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Axis and button definitions for my new controller class</span>

<span class="sd">        :param float dead_zone:</span>
<span class="sd">            Used to set the dead zone for each :class:`approxeng.input.CentredAxis` in the controller.</span>
<span class="sd">        :param float hot_zone:</span>
<span class="sd">            Used to set the hot zone for each :class:`approxeng.input.CentredAxis` in the controller.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyNewController</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">vendor_id</span><span class="o">=</span><span class="n">MY_VENDOR_ID</span><span class="p">,</span>
                                              <span class="n">product_id</span><span class="o">=</span><span class="n">MY_PRODUCT_ID</span><span class="p">,</span>
                                              <span class="n">controls</span><span class="o">=</span><span class="p">[],</span>
                                              <span class="n">dead_zone</span><span class="o">=</span><span class="n">dead_zone</span><span class="p">,</span>
                                              <span class="n">hot_zone</span><span class="o">=</span><span class="n">hot_zone</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;My new controller&#39;</span>
</pre></div>
</div>
<p>This is a fairly useless controller, because it doesn&#8217;t have any buttons or axes, but it will get us to the point where
the library tries to send events to it, and that&#8217;s important because when an event is received and not processed by the
controller class we just print it to the console. This means that if you register your new class with its associated
vendor and product IDs (as above) and run the <cite>scripts/select_binder_resource_example.py</cite> script you should start seeing
messages about unknown axes and buttons. You can then go back to this class definition and use this information to add
controls until you&#8217;re not getting any of these &#8216;missing control&#8217; messages and everything&#8217;s working.</p>
<p>Controls are all added to the <cite>controls</cite> parameter of the constructor, you should look at the documentation for the
various axis and button classes to see what they take as arguments, these are currently:</p>
<ul class="simple">
<li><code class="xref py py-class docutils literal"><span class="pre">approxeng.input.CentredAxis</span></code> for analogue axes which have a resting point in the centre of their range.</li>
<li><code class="xref py py-class docutils literal"><span class="pre">approxeng.input.TriggerAxis</span></code> for analogue axes which have a resting point at one end of their range.</li>
<li><code class="xref py py-class docutils literal"><span class="pre">approxeng.input.BinaryAxis</span></code> for analogue axes which are really pairs of buttons, both the PS4 and XBox One
controllers use this for their direction pads, the buttons on these pads don&#8217;t appear as buttons in the event stream
but as an analogue axis which only ever takes the values -1, 0 or 1.</li>
<li><code class="xref py py-class docutils literal"><span class="pre">approxeng.input.Button</span></code> for buttons</li>
</ul>
<p>You should take a look at the source for the existing controller classes, i.e.
<code class="xref py py-class docutils literal"><span class="pre">approxeng.input.xboxone.WirelessXBoxOneSPad</span></code> to see how these are used. For every control you need to know the
event code, for analogue axes you&#8217;ll also need to know the range of values the controller can produce so the library
can normalise these to a -1.0 to 1.0, or 0.0 to 1.0 range. Check out the list of <a class="reference internal" href="simpleusage.html#sname-label"><span>Standard Names</span></a> to make your new
controller class drop-in compatible with existing code, and let me know about it by raising either a pull request or a
new issue on github, I&#8217;m sure others would like to know about the new functionality!</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="examples.html" class="btn btn-neutral float-right" title="Examples">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="api/spacemousepro.html" class="btn btn-neutral" title="Wired SpaceMouse Pro Support"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Tom Oinn.
      Last updated on Feb 11, 2019.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>