<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tiny4WD Robot Drive &mdash; Approximate Engineering - Input 2.6.4 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5248d183"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Approximate Engineering - Input 2.6.4 documentation"
          href="../_static/opensearch.xml"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Advanced Usage Guide" href="../howtouse.html" />
    <link rel="prev" title="Streaming Axis and Button Hold values" href="streams.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Approximate Engineering - Input
          </a>
              <div class="version">
                2.6.4
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../simpleusage.html">Simple Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../simpleusage.html#standard-names">Standard Names</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commandline.html">Command-line tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bluetooth.html">Pairing Controllers over Bluetooth</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profiling.html">Profiling and Testing Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../addingcontrollers.html">Adding support for a new controller type</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="camjam.html">CamJam Edukit 3 Robot</a></li>
<li class="toctree-l2"><a class="reference internal" href="failover.html">Controller Failover</a></li>
<li class="toctree-l2"><a class="reference internal" href="streams.html">Streaming Axis and Button Hold values</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Tiny4WD Robot Drive</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../howtouse.html">Advanced Usage Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sys.html">LEDs and Battery Monitoring</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Approximate Engineering - Input</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../examples.html">Examples</a></li>
      <li class="breadcrumb-item active">Tiny4WD Robot Drive</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tiny4wd-robot-drive">
<span id="example-tiny4wd"></span><h1>Tiny4WD Robot Drive<a class="headerlink" href="#tiny4wd-robot-drive" title="Link to this heading"></a></h1>
<p>Tiny4WD is a great first robot kit designed by Brian Corteil (<a class="reference external" href="https://twitter.com/cannonfodder">&#64;CannonFodder</a> and
<a class="reference external" href="https://twitter.com/coretecrobotics">&#64;CoretecRobotics</a>). You can buy the kits from the lovely, if money-sucking,
pirates at <a class="reference external" href="https://twitter.com/pimoroni">&#64;pimoroni</a> from
<a class="reference external" href="https://shop.pimoroni.com/products/coretec-tiny-4wd-robot-rover">their online shop</a>. The code below shows, with a
few extra bits and pieces needed in case you’re running without the robot libraries, how to use this library to drive
it around. The left analogue stick controls the robot, and the HOME button exits.</p>
<img alt="../_images/tiny4wd.jpg" src="../_images/tiny4wd.jpg" />
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="c1"># Code for Brian Corteil&#39;s Tiny 4WD robot, based on code from Brian as modified by Emma Norling.</span>
<span class="linenos">  2</span><span class="c1"># Subsequently modified by Tom Oinn to add dummy functions when no explorer hat is available,</span>
<span class="linenos">  3</span><span class="c1"># use any available joystick, use the new function in 1.0.6 of approxeng.input to get multiple</span>
<span class="linenos">  4</span><span class="c1"># axis values in a single call, use implicit de-structuring of tuples to reduce verbosity, add</span>
<span class="linenos">  5</span><span class="c1"># an exception to break out of the control loop on pressing HOME etc.</span>
<span class="linenos">  6</span>
<span class="linenos">  7</span><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="linenos">  8</span>
<span class="linenos">  9</span><span class="k">try</span><span class="p">:</span>
<span class="linenos"> 10</span>    <span class="c1"># Attempt to import the Explorer HAT library. If this fails, because we&#39;re running somewhere</span>
<span class="linenos"> 11</span>    <span class="c1"># that doesn&#39;t have the library, we create dummy functions for set_speeds and stop_motors which</span>
<span class="linenos"> 12</span>    <span class="c1"># just print out what they&#39;d have done. This is a fairly common way to deal with hardware that</span>
<span class="linenos"> 13</span>    <span class="c1"># may or may not exist! Obviously if you&#39;re actually running this on one of Brian&#39;s robots you</span>
<span class="linenos"> 14</span>    <span class="c1"># should have the Explorer HAT libraries installed, this is really just so I can test on my big</span>
<span class="linenos"> 15</span>    <span class="c1"># linux desktop machine when coding.</span>
<span class="linenos"> 16</span>
<span class="linenos"> 17</span>    <span class="kn">from</span> <span class="nn">explorerhat</span> <span class="kn">import</span> <span class="n">motor</span>
<span class="linenos"> 18</span>
<span class="linenos"> 19</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Explorer HAT library available.&#39;</span><span class="p">)</span>
<span class="linenos"> 20</span>
<span class="linenos"> 21</span>
<span class="linenos"> 22</span>    <span class="k">def</span> <span class="nf">set_speeds</span><span class="p">(</span><span class="n">power_left</span><span class="p">,</span> <span class="n">power_right</span><span class="p">):</span>
<span class="linenos"> 23</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 24</span><span class="sd">        As we have an motor hat, we can use the motors</span>
<span class="linenos"> 25</span><span class="sd">        </span>
<span class="linenos"> 26</span><span class="sd">        :param power_left: </span>
<span class="linenos"> 27</span><span class="sd">            Power to send to left motor</span>
<span class="linenos"> 28</span><span class="sd">        :param power_right: </span>
<span class="linenos"> 29</span><span class="sd">            Power to send to right motor, will be inverted to reflect chassis layout</span>
<span class="linenos"> 30</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 31</span>        <span class="n">motor</span><span class="o">.</span><span class="n">one</span><span class="o">.</span><span class="n">speed</span><span class="p">(</span><span class="o">-</span><span class="n">power_right</span><span class="p">)</span>
<span class="linenos"> 32</span>        <span class="n">motor</span><span class="o">.</span><span class="n">two</span><span class="o">.</span><span class="n">speed</span><span class="p">(</span><span class="n">power_left</span><span class="p">)</span>
<span class="linenos"> 33</span>
<span class="linenos"> 34</span>
<span class="linenos"> 35</span>    <span class="k">def</span> <span class="nf">stop_motors</span><span class="p">():</span>
<span class="linenos"> 36</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 37</span><span class="sd">        As we have an motor hat, stop the motors using their motors call</span>
<span class="linenos"> 38</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 39</span>        <span class="n">motor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
<span class="linenos"> 40</span>
<span class="linenos"> 41</span><span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
<span class="linenos"> 42</span>
<span class="linenos"> 43</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No explorer HAT library available, using dummy functions.&#39;</span><span class="p">)</span>
<span class="linenos"> 44</span>
<span class="linenos"> 45</span>
<span class="linenos"> 46</span>    <span class="k">def</span> <span class="nf">set_speeds</span><span class="p">(</span><span class="n">power_left</span><span class="p">,</span> <span class="n">power_right</span><span class="p">):</span>
<span class="linenos"> 47</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 48</span><span class="sd">        No motor hat - print what we would have sent to it if we&#39;d had one.</span>
<span class="linenos"> 49</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 50</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Left: </span><span class="si">{}</span><span class="s1">, Right: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">power_left</span><span class="p">,</span> <span class="n">power_right</span><span class="p">))</span>
<span class="linenos"> 51</span>        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
<span class="linenos"> 52</span>
<span class="linenos"> 53</span>
<span class="linenos"> 54</span>    <span class="k">def</span> <span class="nf">stop_motors</span><span class="p">():</span>
<span class="linenos"> 55</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 56</span><span class="sd">        No motor hat, so just print a message.</span>
<span class="linenos"> 57</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 58</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Motors stopping&#39;</span><span class="p">)</span>
<span class="linenos"> 59</span>
<span class="linenos"> 60</span><span class="c1"># All we need, as we don&#39;t care which controller we bind to, is the ControllerResource</span>
<span class="linenos"> 61</span><span class="kn">from</span> <span class="nn">approxeng.input.selectbinder</span> <span class="kn">import</span> <span class="n">ControllerResource</span>
<span class="linenos"> 62</span>
<span class="linenos"> 63</span>
<span class="linenos"> 64</span><span class="k">class</span> <span class="nc">RobotStopException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="linenos"> 65</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 66</span><span class="sd">    The simplest possible subclass of Exception, we&#39;ll raise this if we want to stop the robot</span>
<span class="linenos"> 67</span><span class="sd">    for any reason. Creating a custom exception like this makes the code more readable later.</span>
<span class="linenos"> 68</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 69</span>    <span class="k">pass</span>
<span class="linenos"> 70</span>
<span class="linenos"> 71</span>
<span class="linenos"> 72</span><span class="k">def</span> <span class="nf">mixer</span><span class="p">(</span><span class="n">yaw</span><span class="p">,</span> <span class="n">throttle</span><span class="p">,</span> <span class="n">max_power</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<span class="linenos"> 73</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 74</span><span class="sd">    Mix a pair of joystick axes, returning a pair of wheel speeds. This is where the mapping from</span>
<span class="linenos"> 75</span><span class="sd">    joystick positions to wheel powers is defined, so any changes to how the robot drives should</span>
<span class="linenos"> 76</span><span class="sd">    be made here, everything else is really just plumbing.</span>
<span class="linenos"> 77</span><span class="sd">    </span>
<span class="linenos"> 78</span><span class="sd">    :param yaw: </span>
<span class="linenos"> 79</span><span class="sd">        Yaw axis value, ranges from -1.0 to 1.0</span>
<span class="linenos"> 80</span><span class="sd">    :param throttle: </span>
<span class="linenos"> 81</span><span class="sd">        Throttle axis value, ranges from -1.0 to 1.0</span>
<span class="linenos"> 82</span><span class="sd">    :param max_power: </span>
<span class="linenos"> 83</span><span class="sd">        Maximum speed that should be returned from the mixer, defaults to 100</span>
<span class="linenos"> 84</span><span class="sd">    :return: </span>
<span class="linenos"> 85</span><span class="sd">        A pair of power_left, power_right integer values to send to the motor driver</span>
<span class="linenos"> 86</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 87</span>    <span class="n">left</span> <span class="o">=</span> <span class="n">throttle</span> <span class="o">+</span> <span class="n">yaw</span>
<span class="linenos"> 88</span>    <span class="n">right</span> <span class="o">=</span> <span class="n">throttle</span> <span class="o">-</span> <span class="n">yaw</span>
<span class="linenos"> 89</span>    <span class="n">scale</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">max_power</span><span class="p">)</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">left</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">right</span><span class="p">))</span>
<span class="linenos"> 90</span>    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">left</span> <span class="o">*</span> <span class="n">scale</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">right</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>
<span class="linenos"> 91</span>
<span class="linenos"> 92</span>
<span class="linenos"> 93</span><span class="c1"># Outer try / except catches the RobotStopException we just defined, which we&#39;ll raise when we want to</span>
<span class="linenos"> 94</span><span class="c1"># bail out of the loop cleanly, shutting the motors down. We can raise this in response to a button press</span>
<span class="linenos"> 95</span><span class="k">try</span><span class="p">:</span>
<span class="linenos"> 96</span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos"> 97</span>        <span class="c1"># Inner try / except is used to wait for a controller to become available, at which point we</span>
<span class="linenos"> 98</span>        <span class="c1"># bind to it and enter a loop where we read axis values and send commands to the motors.</span>
<span class="linenos"> 99</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">100</span>            <span class="c1"># Bind to any available joystick, this will use whatever&#39;s connected as long as the library</span>
<span class="linenos">101</span>            <span class="c1"># supports it.</span>
<span class="linenos">102</span>            <span class="k">with</span> <span class="n">ControllerResource</span><span class="p">(</span><span class="n">dead_zone</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">hot_zone</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span> <span class="k">as</span> <span class="n">joystick</span><span class="p">:</span>
<span class="linenos">103</span>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Controller found, press HOME button to exit, use left stick to drive.&#39;</span><span class="p">)</span>
<span class="linenos">104</span>                <span class="nb">print</span><span class="p">(</span><span class="n">joystick</span><span class="o">.</span><span class="n">controls</span><span class="p">)</span>
<span class="linenos">105</span>                <span class="c1"># Loop until the joystick disconnects, or we deliberately stop by raising a</span>
<span class="linenos">106</span>                <span class="c1"># RobotStopException</span>
<span class="linenos">107</span>                <span class="k">while</span> <span class="n">joystick</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
<span class="linenos">108</span>                    <span class="c1"># Get joystick values from the left analogue stick</span>
<span class="linenos">109</span>                    <span class="n">x_axis</span><span class="p">,</span> <span class="n">y_axis</span> <span class="o">=</span> <span class="n">joystick</span><span class="p">[</span><span class="s1">&#39;lx&#39;</span><span class="p">,</span> <span class="s1">&#39;ly&#39;</span><span class="p">]</span>
<span class="linenos">110</span>                    <span class="c1"># Get power from mixer function</span>
<span class="linenos">111</span>                    <span class="n">power_left</span><span class="p">,</span> <span class="n">power_right</span> <span class="o">=</span> <span class="n">mixer</span><span class="p">(</span><span class="n">yaw</span><span class="o">=</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">throttle</span><span class="o">=</span><span class="n">y_axis</span><span class="p">)</span>
<span class="linenos">112</span>                    <span class="c1"># Set motor speeds</span>
<span class="linenos">113</span>                    <span class="n">set_speeds</span><span class="p">(</span><span class="n">power_left</span><span class="p">,</span> <span class="n">power_right</span><span class="p">)</span>
<span class="linenos">114</span>                    <span class="c1"># Get a ButtonPresses object containing everything that was pressed since the last</span>
<span class="linenos">115</span>                    <span class="c1"># time around this loop.</span>
<span class="linenos">116</span>                    <span class="n">joystick</span><span class="o">.</span><span class="n">check_presses</span><span class="p">()</span>
<span class="linenos">117</span>                    <span class="c1"># Print out any buttons that were pressed, if we had any</span>
<span class="linenos">118</span>                    <span class="k">if</span> <span class="n">joystick</span><span class="o">.</span><span class="n">has_presses</span><span class="p">:</span>
<span class="linenos">119</span>                        <span class="nb">print</span><span class="p">(</span><span class="n">joystick</span><span class="o">.</span><span class="n">presses</span><span class="p">)</span>
<span class="linenos">120</span>                    <span class="c1"># If home was pressed, raise a RobotStopException to bail out of the loop</span>
<span class="linenos">121</span>                    <span class="c1"># Home is generally the PS button for playstation controllers, XBox for XBox etc</span>
<span class="linenos">122</span>                    <span class="k">if</span> <span class="s1">&#39;home&#39;</span> <span class="ow">in</span> <span class="n">joystick</span><span class="o">.</span><span class="n">presses</span><span class="p">:</span>
<span class="linenos">123</span>                        <span class="k">raise</span> <span class="n">RobotStopException</span><span class="p">()</span>
<span class="linenos">124</span>        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
<span class="linenos">125</span>            <span class="c1"># We get an IOError when using the ControllerResource if we don&#39;t have a controller yet,</span>
<span class="linenos">126</span>            <span class="c1"># so in this case we just wait a second and try again after printing a message.</span>
<span class="linenos">127</span>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No controller found yet&#39;</span><span class="p">)</span>
<span class="linenos">128</span>            <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">129</span><span class="k">except</span> <span class="n">RobotStopException</span><span class="p">:</span>
<span class="linenos">130</span>    <span class="c1"># This exception will be raised when the home button is pressed, at which point we should</span>
<span class="linenos">131</span>    <span class="c1"># stop the motors.</span>
<span class="linenos">132</span>    <span class="n">stop_motors</span><span class="p">()</span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="streams.html" class="btn btn-neutral float-left" title="Streaming Axis and Button Hold values" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../howtouse.html" class="btn btn-neutral float-right" title="Advanced Usage Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017 to 2024 Tom Oinn.
      <span class="lastupdated">Last updated on Feb 15, 2024.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>