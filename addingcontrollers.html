

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Adding support for a new controller type &mdash; Approximate Engineering - Input 2.4.3 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Approximate Engineering - Input 2.4.3 documentation"
          href="_static/opensearch.xml"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Examples" href="examples.html" />
    <link rel="prev" title="Wired SpaceMouse Pro Support" href="api/spacemousepro.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Approximate Engineering - Input
          

          
          </a>

          
            
            
              <div class="version">
                2.4.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="simpleusage.html">Simple Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="simpleusage.html#standard-names">Standard Names</a></li>
<li class="toctree-l1"><a class="reference internal" href="bluetooth.html">Pairing Controllers over Bluetooth</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Documentation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Adding support for a new controller type</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#finding-your-product-and-vendor-id">Finding your product and vendor ID</a></li>
<li class="toctree-l2"><a class="reference internal" href="#clones-of-a-supported-controller">Clones of a supported controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="#writing-a-new-controller-class">Writing a new controller class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="howtouse.html">Advanced Usage Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="sys.html">LEDs and Battery Monitoring</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Approximate Engineering - Input</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Adding support for a new controller type</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="adding-support-for-a-new-controller-type">
<h1>Adding support for a new controller type<a class="headerlink" href="#adding-support-for-a-new-controller-type" title="Permalink to this headline">¶</a></h1>
<p>The library supports a number of controllers but it’s quite possible, given the variety of cheap clones on the market,
that your particular controller isn’t one of them. You have a few options, depending on the scenario you find yourself
in. Firstly though you’ll need both product and vendor IDs for your device - these are allocated by the USB consortium
so will definitely not be the same for a clone device as for an original one, for example.</p>
<div class="section" id="finding-your-product-and-vendor-id">
<h2>Finding your product and vendor ID<a class="headerlink" href="#finding-your-product-and-vendor-id" title="Permalink to this headline">¶</a></h2>
<p>Once you have a controller paired over bluetooth, or, in the case of those with specific dongles, otherwise connected,
you can run the <cite>scripts/list_devices.py</cite> to print out a list of all connected devices, including the vendor and product
identifiers. For example, with my XBox One controller paired and connected I see this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>viridia-env<span class="o">)</span> tom@Ogre ~/git/approxeng.input/scripts $ python list_devices.py
<span class="o">{</span> <span class="s1">&#39;bus&#39;</span>: <span class="m">5</span>,
  <span class="s1">&#39;fn&#39;</span>: <span class="s1">&#39;/dev/input/event14&#39;</span>,
  <span class="s1">&#39;name&#39;</span>: <span class="s1">&#39;Xbox Wireless Controller&#39;</span>,
  <span class="s1">&#39;phys&#39;</span>: <span class="s1">&#39;5c:f3:70:66:5c:e2&#39;</span>,
  <span class="s1">&#39;product&#39;</span>: <span class="m">736</span>,
  <span class="s1">&#39;vendor&#39;</span>: <span class="m">1118</span>,
  <span class="s1">&#39;version&#39;</span>: <span class="m">2307</span><span class="o">}</span>
</pre></div>
</div>
<p>In general this should show you enough information to identify the controller you’ve just connected and get the details.</p>
</div>
<div class="section" id="clones-of-a-supported-controller">
<h2>Clones of a supported controller<a class="headerlink" href="#clones-of-a-supported-controller" title="Permalink to this headline">¶</a></h2>
<p>If you have a controller which is an exact copy of one the library supports, but isn’t autodetected, you can sub-class
the existing one and specify the appropriate return values for <cite>registration_ids</cite></p>
</div>
<div class="section" id="writing-a-new-controller-class">
<h2>Writing a new controller class<a class="headerlink" href="#writing-a-new-controller-class" title="Permalink to this headline">¶</a></h2>
<p>It’s possible you have a controller which is completely different to the ones the library already supports. This might
be because it’s something we’ve just never got our hands on, or because the manufacturer has decided to produce a clone
controller with completely different codes for buttons or axes (it happens!). In this case you’ll need to create a new
subclass of <a class="reference internal" href="api/input.html#approxeng.input.Controller" title="approxeng.input.Controller"><code class="xref py py-class docutils literal notranslate"><span class="pre">Controller</span></code></a> and use the mechanism above to register it. Fortunately this is fairly
simple. First create your class, this won’t include any button or axis bindings, we’ll add these later:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">approxeng.input</span> <span class="kn">import</span> <span class="n">Controller</span>

<span class="n">MY_VENDOR_ID</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">MY_PRODUCT_ID</span> <span class="o">=</span> <span class="o">...</span>


<span class="k">class</span> <span class="nc">MyNewController</span><span class="p">(</span><span class="n">Controller</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Driver for my new controller type</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dead_zone</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">hot_zone</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Axis and button definitions for my new controller class</span>

<span class="sd">        :param float dead_zone:</span>
<span class="sd">            Used to set the dead zone for each :class:`approxeng.input.CentredAxis` in the controller.</span>
<span class="sd">        :param float hot_zone:</span>
<span class="sd">            Used to set the hot zone for each :class:`approxeng.input.CentredAxis` in the controller.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyNewController</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">vendor_id</span><span class="o">=</span><span class="n">MY_VENDOR_ID</span><span class="p">,</span>
                                              <span class="n">product_id</span><span class="o">=</span><span class="n">MY_PRODUCT_ID</span><span class="p">,</span>
                                              <span class="n">controls</span><span class="o">=</span><span class="p">[],</span>
                                              <span class="n">dead_zone</span><span class="o">=</span><span class="n">dead_zone</span><span class="p">,</span>
                                              <span class="n">hot_zone</span><span class="o">=</span><span class="n">hot_zone</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;My new controller&#39;</span>
</pre></div>
</div>
<p>This is a fairly useless controller, because it doesn’t have any buttons or axes, but it will get us to the point where
the library tries to send events to it, and that’s important because when an event is received and not processed by the
controller class we just print it to the console. This means that if you register your new class with its associated
vendor and product IDs (as above) and run the <cite>scripts/select_binder_resource_example.py</cite> script you should start seeing
messages about unknown axes and buttons. You can then go back to this class definition and use this information to add
controls until you’re not getting any of these ‘missing control’ messages and everything’s working.</p>
<p>Controls are all added to the <cite>controls</cite> parameter of the constructor, you should look at the documentation for the
various axis and button classes to see what they take as arguments, these are currently:</p>
<ul class="simple">
<li><p><a class="reference internal" href="api/input.html#approxeng.input.CentredAxis" title="approxeng.input.CentredAxis"><code class="xref py py-class docutils literal notranslate"><span class="pre">CentredAxis</span></code></a> for analogue axes which have a resting point in the centre of their range.</p></li>
<li><p><a class="reference internal" href="api/input.html#approxeng.input.TriggerAxis" title="approxeng.input.TriggerAxis"><code class="xref py py-class docutils literal notranslate"><span class="pre">TriggerAxis</span></code></a> for analogue axes which have a resting point at one end of their range.</p></li>
<li><p><a class="reference internal" href="api/input.html#approxeng.input.BinaryAxis" title="approxeng.input.BinaryAxis"><code class="xref py py-class docutils literal notranslate"><span class="pre">BinaryAxis</span></code></a> for analogue axes which are really pairs of buttons, both the PS4 and XBox One
controllers use this for their direction pads, the buttons on these pads don’t appear as buttons in the event stream
but as an analogue axis which only ever takes the values -1, 0 or 1.</p></li>
<li><p><a class="reference internal" href="api/input.html#approxeng.input.Button" title="approxeng.input.Button"><code class="xref py py-class docutils literal notranslate"><span class="pre">Button</span></code></a> for buttons</p></li>
</ul>
<p>You should take a look at the source for the existing controller classes, i.e.
<a class="reference internal" href="api/xboxone.html#approxeng.input.xboxone.WirelessXBoxOneSPad" title="approxeng.input.xboxone.WirelessXBoxOneSPad"><code class="xref py py-class docutils literal notranslate"><span class="pre">WirelessXBoxOneSPad</span></code></a> to see how these are used. For every control you need to know the
event code, for analogue axes you’ll also need to know the range of values the controller can produce so the library
can normalise these to a -1.0 to 1.0, or 0.0 to 1.0 range. Check out the list of <a class="reference internal" href="simpleusage.html#sname-label"><span class="std std-ref">Standard Names</span></a> to make your new
controller class drop-in compatible with existing code, and let me know about it by raising either a pull request or a
new issue on github, I’m sure others would like to know about the new functionality!</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="examples.html" class="btn btn-neutral float-right" title="Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="api/spacemousepro.html" class="btn btn-neutral float-left" title="Wired SpaceMouse Pro Support" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2017, 2018, 2019, 2020 Tom Oinn
      <span class="lastupdated">
        Last updated on Sep 11, 2020.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>